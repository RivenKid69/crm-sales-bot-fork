"""
–°—Ç—Ä–æ–≥–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–π 401-450.
–¢—Ä–µ–±—É–µ—Ç—Å—è –¢–û–ß–ù–û–ï –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é (–≤ —Ç–æ–ø-3), –∏–Ω–∞—á–µ —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω.
"""

import sys
import os
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..', 'src'))

from knowledge.retriever import CascadeRetriever, MatchStage

# –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: topic -> [—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã]
# –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –¢–û–ß–ù–û –ø–æ–ø–∞–¥–∞—Ç—å –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
TEST_QUERIES = {
    # === SUPPORT SECTIONS (401-410, 414-422) ===
    "support_setup_401": [
        "–∫—Ç–æ –º–Ω–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç wipon?",
        "–∫—Ç–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –∫–∞—Å—Å—É wipon?",
        "–ø–æ–º–æ–≥–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å wipon –ø–æ–∂–∞–ª—É–π—Å—Ç–∞",
    ],
    "support_installation_402": [
        "–≤—ã —Å–∞–º–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É?",
        "—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∫–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?",
        "–∫—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç wipon?",
    ],
    "support_remote_setup_403": [
        "—É–¥–∞–ª—ë–Ω–Ω–æ —Å—Ç–∞–≤–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É?",
        "–≤—ã–µ–∑–¥–Ω–æ–π –º–æ–Ω—Ç–∞–∂ –¥–µ–ª–∞–µ—Ç–µ?",
        "–º–æ–Ω—Ç–∞–∂ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∫–∞–∫?",
    ],
    "support_onsite_visit_404": [
        "–≤—ã –ø—Ä–∏–µ–∑–∂–∞–µ—Ç–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å?",
        "–ø—Ä–∏–µ–¥–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å wipon?",
        "–º–∞—Å—Ç–µ—Ä –ø—Ä–∏–µ–¥–µ—Ç –∫ –Ω–∞–º?",
    ],
    "support_different_business_405": [
        "—É –º–µ–Ω—è –¥—Ä—É–≥–æ–π –≤–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
        "–ø–æ–¥–æ–π–¥—ë—Ç –¥–ª—è –º–æ–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞ wipon?",
        "—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞ –±–∏–∑–Ω–µ—Å–∞ —É –º–µ–Ω—è –æ—Å–æ–±–∞—è",
    ],
    "support_refund_request_406": [
        "—Ö–æ—á—É –≤–µ—Ä–Ω—É—Ç—å –¥–µ–Ω—å–≥–∏ –∑–∞ wipon",
        "—Ö–æ—á—É –æ—Ñ–æ—Ä–º–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥",
        "–º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å –¥–µ–Ω—å–≥–∏?",
    ],
    "support_refund_timing_407": [
        "–∫–æ–≥–¥–∞ –≤–µ—Ä–Ω—ë—Ç–µ –¥–µ–Ω—å–≥–∏?",
        "—Å–∫–æ–ª—å–∫–æ –∂–¥–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –¥–µ–Ω–µ–≥?",
        "—Å—Ä–æ–∫–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–∞–∫–∏–µ?",
    ],
    "support_return_policy_408": [
        "–º—ã –ø–µ—Ä–µ–¥—É–º–∞–ª–∏ –ø–æ–∫—É–ø–∞—Ç—å",
        "—Ö–æ—Ç–∏–º –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç –∑–∞–∫–∞–∑–∞",
        "–æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ–∫—É–ø–∫—É –º–æ–∂–Ω–æ?",
    ],
    "support_equipment_return_409": [
        "—Ö–æ—á—É –≤–µ—Ä–Ω—É—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ wipon",
        "—Ç–µ—Ö–Ω–∏–∫–∞ wipon –Ω–µ –ø–æ–¥–æ—à–ª–∞",
        "–≤–µ—Ä–Ω—É—Ç—å –∫—É–ø–ª–µ–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ wipon",
    ],
    "support_program_refund_410": [
        "–≤–µ—Ä–Ω—É—Ç—å –æ–ø–ª–∞—Ç—É –∑–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É wipon",
        "–ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –ø–æ–¥–æ—à–ª–∞ –≤–æ–∑–≤—Ä–∞—Ç",
        "–≤–æ–∑–≤—Ä–∞—Ç –∑–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É wipon",
    ],
    "support_payment_confirmed_414": [
        "—è —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª wipon",
        "–¥–µ–Ω—å–≥–∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –≤–∞–º",
        "–æ–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ",
    ],
    "support_payment_check_415": [
        "–ø–µ—Ä–µ–≤—ë–ª –æ–ø–ª–∞—Ç—É –ø—Ä–æ–≤–µ—Ä—å—Ç–µ",
        "–ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –º–æ—é –æ–ø–ª–∞—Ç—É –ø–æ–∂–∞–ª—É–π—Å—Ç–∞",
        "–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã",
    ],
    "support_kaspi_payment_416": [
        "–æ–ø–ª–∞—Ç–∏–ª —á–µ—Ä–µ–∑ kaspi –∫–æ–≥–¥–∞ —Å–≤—è–∂–µ—Ç–µ—Å—å?",
        "—Å–∫–∏–Ω—É–ª –¥–µ–Ω—å–≥–∏ –Ω–∞ kaspi –∂–¥—É",
        "kaspi –¥–µ–Ω—å–≥–∏ –ø–µ—Ä–µ–≤—ë–ª –≤–∞–º",
    ],
    "support_equipment_payment_417": [
        "–æ–ø–ª–∞—Ç–∏–ª –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ wipon",
        "—Ç–µ—Ö–Ω–∏–∫–∞ wipon –æ–ø–ª–∞—á–µ–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ",
        "–æ–ø–ª–∞—Ç–∞ –∑–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ wipon –ø—Ä–æ—à–ª–∞",
    ],
    "support_activation_timing_418": [
        "–æ–ø–ª–∞—Ç–∏–ª –∫–æ–≥–¥–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ wipon?",
        "–≤–Ω—ë—Å –æ–ø–ª–∞—Ç—É –∫–æ–≥–¥–∞ –Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ wipon?",
        "—Å—Ä–æ–∫–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ wipon?",
    ],
    "support_payment_kz_419": [
        "—Ç”©–ª–µ–ø “õ–æ–π–¥—ã–º —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑",
        "–∞“õ—à–∞ –∂—ñ–±–µ—Ä–¥—ñ–º wipon",
        "—Ç”©–ª–µ–º –∂–∞—Å–∞–¥—ã–º —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑",
    ],
    "support_receipt_kz_420": [
        "—á–µ–∫ –∂—ñ–±–µ—Ä–¥—ñ–º “õ–∞—Ä–∞“£—ã–∑—à—ã",
        "–∫–≤–∏—Ç–∞–Ω—Ü–∏—è –∂—ñ–±–µ—Ä–¥—ñ–º —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑",
        "—á–µ–∫ —Ç–µ–∫—Å–µ—Ä—É ”©—Ç—ñ–Ω–µ–º—ñ–Ω",
    ],
    "support_kaspi_kz_421": [
        "kaspi –∞—Ä“õ—ã–ª—ã —Ç”©–ª–µ–º –∂–∞—Å–∞–¥—ã–º —Ç–µ–∫—Å–µ—Ä—ñ“£—ñ–∑",
        "–∫–∞—Å–ø–∏ –∞—Ä“õ—ã–ª—ã —Ç”©–ª–µ–¥—ñ–º “õ–∞—à–∞–Ω —Ö–∞–±–∞—Ä–ª–∞—Å–∞—Å—ã–∑",
        "kaspi –∞“õ—à–∞ –∂—ñ–±–µ—Ä–¥—ñ–º –∫“Ø—Ç–µ–º—ñ–Ω",
    ],
    "support_delivery_kz_422": [
        "–∂–∞–±–¥—ã“õ—Ç—ã —Å–∞—Ç—ã–ø –∞–ª–¥—ã–º “õ–∞—à–∞–Ω –∂–µ—Ç–∫—ñ–∑–µ—Å—ñ–∑–¥–µ—Ä?",
        "–∂–∞–±–¥—ã“õ –∂–µ—Ç–∫—ñ–∑—É —É–∞“õ—ã—Ç—ã “õ–∞—à–∞–Ω?",
        "–¥–æ—Å—Ç–∞–≤–∫–∞ “õ–∞—à–∞–Ω –±–æ–ª–∞–¥—ã –∂–∞–±–¥—ã“õ?",
    ],

    # === REGIONS SECTIONS (412-413) ===
    "regions_offices_412": [
        "–æ—Ñ–∏—Å—ã wipon –≤ –∫–∞–∫–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö?",
        "–æ—Ñ–∏—Å—ã –µ—Å—Ç—å –≤ –∞—Å—Ç–∞–Ω–µ –∏ –∞–ª–º–∞—Ç—ã?",
        "–≤ –∫–∞–∫–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö –æ—Ñ–∏—Å—ã wipon?",
    ],
    "regions_location_413": [
        "–≥–¥–µ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å wipon?",
        "–≤–∞—à –∞–¥—Ä–µ—Å wipon –æ—Ñ–∏—Å–∞?",
        "wipon –æ—Ñ–∏—Å –∞–¥—Ä–µ—Å –∫–∞–∫–æ–π?",
    ],

    # === EQUIPMENT SECTIONS (411) ===
    "equipment_quadro_411": [
        "wipon quadro —Ü–µ–Ω–∞",
        "–∫–≤–∞–¥—Ä–æ –º–æ–Ω–æ–±–ª–æ–∫ wipon",
        "quadro –∫–∞—Å—Å–∞ —Å–∫–æ–ª—å–∫–æ?",
    ],

    # === PRODUCTS SECTIONS (423, 425, 443-450) ===
    "products_theft_protection_kz_423": [
        "“±—Ä–ª—ã“õ—Ç–∞–Ω “õ–æ—Ä“ì–∞—É wipon",
        "–∫–∞—Å—Å–∏—Ä ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Ä—ñ–Ω –±–∞“õ—ã–ª–∞—É wipon",
        "—Ç–∞—É–∞—Ä “±—Ä–ª—ã“ì—ã –∞–ª–¥—ã–Ω –∞–ª—É",
    ],
    "products_wipon_overview_kz_425": [
        "wipon —Ç—É—Ä–∞–ª—ã –∞–π—Ç—ã“£—ã–∑",
        "wipon –±–∞“ì–¥–∞—Ä–ª–∞–º–∞—Å—ã –Ω–µ —ñ—Å—Ç–µ–π–¥—ñ?",
        "910 –Ω—ã—Å–∞–Ω—ã wipon –±–∞—Ä –º–∞?",
    ],
    "products_what_is_wipon_443": [
        "wipon —ç—Ç–æ —á—Ç–æ —Ç–∞–∫–æ–µ?",
        "—á—Ç–æ —Ç–∞–∫–æ–µ wipon –≤–æ–æ–±—â–µ?",
        "—ç—Ç–æ –∫–∞—Å—Å–∞ –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ wipon?",
    ],
    "products_small_shop_444": [
        "–ø–æ–¥–æ–π–¥—ë—Ç –¥–ª—è –Ω–µ–±–æ–ª—å—à–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞ wipon?",
        "–º–∞–ª–µ–Ω—å–∫–∞—è —Ç–æ—á–∫–∞ –ø–æ–¥–æ–π–¥—ë—Ç wipon?",
        "–¥–ª—è –º–∞–ª–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞ wipon –ø–æ–¥—Ö–æ–¥–∏—Ç?",
    ],
    "products_easy_to_use_445": [
        "—Å–ª–æ–∂–Ω–æ –ª–∏ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ wipon?",
        "–ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É wipon?",
        "–±–µ–∑ –æ–ø—ã—Ç–∞ —Å–º–æ–≥—É —Ä–∞–±–æ—Ç–∞—Ç—å –≤ wipon?",
    ],
    "products_equipment_required_446": [
        "–Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫—É–ø–∞—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –¥–ª—è wipon?",
        "wipon —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ?",
        "–º–æ–∂–Ω–æ –±–µ–∑ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å wipon?",
    ],
    "products_advantages_447": [
        "—á–µ–º wipon –ª—É—á—à–µ –¥—Ä—É–≥–∏—Ö?",
        "–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ wipon –∫–∞–∫–∏–µ?",
        "–ø–æ—á–µ–º—É wipon –≤—ã–±—Ä–∞—Ç—å?",
    ],
    "products_what_is_wipon_448": [
        "–ø–µ—Ä–≤—ã–π —Ä–∞–∑ —Å–ª—ã—à—É –ø—Ä–æ wipon",
        "wipon –≤–æ–æ–±—â–µ —á—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?",
        "—Å–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ wipon —ç—Ç–æ —á—Ç–æ?",
    ],
    "products_difficulty_449": [
        "–¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö –ø–æ–¥–æ–π–¥—ë—Ç wipon?",
        "–ø–æ–º–æ–≥–∏—Ç–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ wipon",
        "–Ω–µ —Ä–∞–∑–±–µ—Ä—É—Å—å –≤ wipon –ø–æ–º–æ–≥–∏—Ç–µ",
    ],
    "products_difference_450": [
        "—ç—Å—Ñ —Å–Ω—Ç wipon –µ—Å—Ç—å?",
        "–∫–∞–∫–∏–µ –æ—Ç–ª–∏—á–∏—è wipon –æ—Ç –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º?",
        "wipon –æ—Ç–ª–∏—á–∏—è –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫–∞–∫–∏–µ?",
    ],

    # === INTEGRATIONS SECTIONS (424) ===
    "integrations_banks_kz_424": [
        "–±–∞–Ω–∫—Ç–µ—Ä–º–µ–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–∞—Ä –º–∞ wipon?",
        "pos —Ç–µ—Ä–º–∏–Ω–∞–ª “õ–æ—Å—É“ì–∞ –±–æ–ª–∞–¥—ã wipon?",
        "–±–∞–Ω–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è—Å—ã wipon “õ–∞–ª–∞–π?",
    ],

    # === TIS SECTIONS (426) ===
    "tis_overview_kz_426": [
        "—Ç–∏—Å —Ç—É—Ä–∞–ª—ã wipon –∞–π—Ç—ã“£—ã–∑",
        "—Ç—ñ—Å wipon “õ–∞–∑–∞“õ—à–∞ –∞“õ–ø–∞—Ä–∞—Ç",
        "—Ç–∏—Å –∂“Ø–π–µ—Å—ñ wipon —Ç—É—Ä–∞–ª—ã",
    ],

    # === PRICING SECTIONS (427-442) ===
    "pricing_tariff_mini_427": [
        "—Ç–∞—Ä–∏—Ñ mini wipon —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç?",
        "—Ç–∞—Ä–∏—Ñ –º–∏–Ω–∏ 5000 —Ç–µ–Ω–≥–µ wipon",
        "5000 –º–µ—Å—è—Ü —Ç–∞—Ä–∏—Ñ mini",
    ],
    "pricing_tariff_lite_428": [
        "—Ç–∞—Ä–∏—Ñ lite wipon —á—Ç–æ –≤—Ö–æ–¥–∏—Ç?",
        "—Ç–∞—Ä–∏—Ñ –ª–∞–π—Ç 150000 –≥–æ–¥ wipon",
        "150000 –≥–æ–¥ —Ç–∞—Ä–∏—Ñ lite",
    ],
    "pricing_tariff_standart_429": [
        "—Ç–∞—Ä–∏—Ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç wipon —Å–∫–æ–ª—å–∫–æ?",
        "—Ç–∞—Ä–∏—Ñ —Å—Ç–∞–Ω–¥–∞—Ä—Ç 220000 —Ç–µ–Ω–≥–µ –≥–æ–¥",
        "standart —Ç–∞—Ä–∏—Ñ 220000 –≥–æ–¥",
    ],
    "pricing_tariff_pro_430": [
        "—Ç–∞—Ä–∏—Ñ pro wipon —Ü–µ–Ω–∞ —Å–∫–æ–ª—å–∫–æ?",
        "—Ç–∞—Ä–∏—Ñ –ø—Ä–æ 500000 wipon",
        "500000 —Ç–µ–Ω–≥–µ —Ç–∞—Ä–∏—Ñ pro wipon",
    ],
    "pricing_wipon_pro_module_431": [
        "wipon pro –º–æ–¥—É–ª—å —Ü–µ–Ω–∞",
        "–º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –º–æ–¥—É–ª—å wipon —Ü–µ–Ω–∞",
        "–º–æ–¥—É–ª—å –∞–∫—Ü–∏–∑–Ω–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏ 12000",
    ],
    "pricing_pos_i3_432": [
        "wipon pos i3 —Ü–µ–Ω–∞ —Å–∫–æ–ª—å–∫–æ?",
        "pos i3 wipon 140000",
        "140000 –º–æ–Ω–æ–±–ª–æ–∫ wipon pos i3",
    ],
    "pricing_screen_433": [
        "–≤—Ç–æ—Ä–æ–π —ç–∫—Ä–∞–Ω wipon —Ü–µ–Ω–∞",
        "wipon screen —Å—Ç–æ–∏–º–æ—Å—Ç—å",
        "—ç–∫—Ä–∞–Ω –ø–æ–∫—É–ø–∞—Ç–µ–ª—è wipon screen",
    ],
    "pricing_triple_434": [
        "wipon triple —Ü–µ–Ω–∞ —Å–∫–æ–ª—å–∫–æ?",
        "triple —Å—Ç–æ–∏–º–æ—Å—Ç—å wipon",
        "triple 330000 —Ç–µ–Ω–≥–µ wipon",
    ],
    "pricing_kit_pro_435": [
        "–∫–∞—Å—Å–æ–≤—ã–π –∫–æ–º–ø–ª–µ–∫—Ç pro wipon —Ü–µ–Ω–∞",
        "–∫–æ–º–ø–ª–µ–∫—Ç pro 360000 wipon",
        "360000 –∫–æ–º–ø–ª–µ–∫—Ç pro wipon",
    ],
    "pricing_smart_scales_436": [
        "—É–º–Ω—ã–µ –≤–µ—Å—ã wipon —Ü–µ–Ω–∞ —Å–∫–æ–ª—å–∫–æ?",
        "—É–º–Ω—ã–µ –≤–µ—Å—ã wipon —Å—Ç–æ–∏–º–æ—Å—Ç—å",
        "–≤–µ—Å—ã 100000 —Ç–µ–Ω–≥–µ wipon",
    ],
    "pricing_cash_drawer_437": [
        "–¥–µ–Ω–µ–∂–Ω—ã–π —è—â–∏–∫ wipon —Ü–µ–Ω–∞ 21000",
        "–¥–µ–Ω–µ–∂–Ω—ã–π —è—â–∏–∫ wipon 21000 —Ç–µ–Ω–≥–µ",
        "21000 –¥–µ–Ω–µ–∂–Ω—ã–π —è—â–∏–∫ wipon",
    ],
    "pricing_scales_rongta_438": [
        "–≤–µ—Å—ã rongta wipon —Ü–µ–Ω–∞",
        "rongta –≤–µ—Å—ã 200000 wipon",
        "200000 rongta wipon",
    ],
    "pricing_stand_zebra_439": [
        "–ø–æ–¥—Å—Ç–∞–≤–∫–∞ zebra wipon —Ü–µ–Ω–∞",
        "zebra wipon 10000",
        "–ø–æ–¥—Å—Ç–∞–≤–∫–∞ zebra 10000 wipon",
    ],
    "pricing_stand_simple_440": [
        "–ø—Ä–æ—Å—Ç–∞—è –ø–æ–¥—Å—Ç–∞–≤–∫–∞ wipon —Ü–µ–Ω–∞",
        "–ø–æ–¥—Å—Ç–∞–≤–∫–∞ wipon 3000",
        "3000 –ø—Ä–æ—Å—Ç–∞—è wipon",
    ],
    "pricing_scanner_wp7600l_441": [
        "—Å–∫–∞–Ω–µ—Ä wp7600l wipon —Ü–µ–Ω–∞",
        "wp7600l 30000 wipon",
        "30000 wp7600l wipon",
    ],
    "pricing_scanner_stationary_442": [
        "—Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π —Å–∫–∞–Ω–µ—Ä wipon —Ü–µ–Ω–∞ 24000",
        "—Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π —Å–∫–∞–Ω–µ—Ä wipon 24000 —Ç–µ–Ω–≥–µ",
        "24000 —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π —Å–∫–∞–Ω–µ—Ä wipon",
    ],
}


def run_strict_tests():
    """–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ç—Ä–æ–≥–∏–µ —Ç–µ—Å—Ç—ã - —Ç—Ä–µ–±—É–µ—Ç—Å—è –¢–û–ß–ù–û–ï –ø–æ–ø–∞–¥–∞–Ω–∏–µ."""
    print("=" * 70)
    print("–°–¢–†–û–ì–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –°–ï–ö–¶–ò–ô 401-450")
    print("=" * 70)
    print("–¢—Ä–µ–±—É–µ—Ç—Å—è –¢–û–ß–ù–û–ï –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é (–≤ —Ç–æ–ø-3)")
    print()

    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è retriever
    import knowledge.retriever as r
    r._retriever = None
    retriever = CascadeRetriever(use_embeddings=False)

    total_tests = 0
    passed_exact = 0
    passed_category = 0
    failed_tests = []

    for expected_topic, queries in TEST_QUERIES.items():
        print(f"\n--- {expected_topic} ---")

        for query in queries:
            total_tests += 1
            results = retriever.search(query, top_k=3)

            if not results:
                failed_tests.append({
                    "expected": expected_topic,
                    "query": query,
                    "error": "NO_RESULTS",
                    "got": None
                })
                print(f"  ‚ùå '{query}' -> –ù–ï–¢ –†–ï–ó–£–õ–¨–¢–ê–¢–û–í")
                continue

            found_topics = [r.section.topic for r in results]
            top_result = results[0]

            if expected_topic in found_topics:
                position = found_topics.index(expected_topic) + 1
                score = results[found_topics.index(expected_topic)].score
                stage = results[found_topics.index(expected_topic)].stage.value
                passed_exact += 1
                if position == 1:
                    print(f"  ‚úÖ '{query}' -> #1 (score={score:.2f})")
                else:
                    print(f"  ‚úÖ '{query}' -> #{position} (score={score:.2f})")
            else:
                # –°—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º - –µ—Å–ª–∏ –Ω–µ –≤ —Ç–æ–ø-3, —ç—Ç–æ –ø—Ä–æ–≤–∞–ª
                top_topic = top_result.section.topic
                top_category = top_result.section.category
                expected_category = expected_topic.split("_")[0]

                if top_category == expected_category:
                    passed_category += 1
                    print(f"  ‚ö†Ô∏è  '{query}' -> {top_topic} (—Ç–∞ –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è)")
                else:
                    failed_tests.append({
                        "expected": expected_topic,
                        "query": query,
                        "error": "WRONG_SECTION",
                        "got": found_topics[0]
                    })
                    print(f"  ‚ùå '{query}' -> {found_topics[0]}")

    # –ò—Ç–æ–≥–∏
    print("\n" + "=" * 70)
    print("–ò–¢–û–ì–ò –°–¢–†–û–ì–û–ì–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø")
    print("=" * 70)
    print(f"–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: {total_tests}")
    print(f"–¢–æ—á–Ω–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ: {passed_exact} ({passed_exact/total_tests*100:.1f}%)")
    print(f"–¢–∞ –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è: {passed_category} ({passed_category/total_tests*100:.1f}%)")
    print(f"–ü—Ä–æ–≤–∞–ª–µ–Ω–æ: {len(failed_tests)} ({len(failed_tests)/total_tests*100:.1f}%)")

    accuracy = passed_exact / total_tests * 100
    print(f"\nüéØ –¢–û–ß–ù–û–°–¢–¨: {accuracy:.1f}%")

    if passed_category > 0:
        print(f"\n‚ö†Ô∏è  –ó–ê–ü–†–û–°–´ –í –¢–û–ô –ñ–ï –ö–ê–¢–ï–ì–û–†–ò–ò (—Ç—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏):")
        # –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏
        problem_sections = set()
        for expected_topic, queries in TEST_QUERIES.items():
            for query in queries:
                results = retriever.search(query, top_k=3)
                if results:
                    found_topics = [r.section.topic for r in results]
                    if expected_topic not in found_topics:
                        top_category = results[0].section.category
                        expected_category = expected_topic.split("_")[0]
                        if top_category == expected_category:
                            problem_sections.add(expected_topic)
        for section in sorted(problem_sections):
            print(f"  - {section}")

    if failed_tests:
        print(f"\n‚ùå –ü–†–û–í–ê–õ–ò–í–®–ò–ï–°–Ø –¢–ï–°–¢–´:")
        for fail in failed_tests:
            print(f"  ‚Ä¢ {fail['expected']}: '{fail['query']}' -> {fail['got']}")

    return passed_exact, total_tests, failed_tests


if __name__ == "__main__":
    passed, total, failed = run_strict_tests()

    # –í—ã—Ö–æ–¥ —Å –∫–æ–¥–æ–º –æ—à–∏–±–∫–∏ –µ—Å–ª–∏ —Ç–æ—á–Ω–æ—Å—Ç—å < 95%
    if passed / total < 0.95:
        sys.exit(1)
