#!/usr/bin/env python3
"""
Тестирование секций 900-1000 базы знаний.
Минимум 5 уникальных клиентских запросов на каждую секцию.
"""

import sys
sys.path.insert(0, 'src')

from src.knowledge.retriever import CascadeRetriever

retriever = CascadeRetriever(use_embeddings=False)

# Тестовые запросы для секций 900-1000 (имитация клиентов)
TEST_QUERIES = {
    # ==================== PRODUCTS ====================
    "products_company_overview_900": [
        "чем занимается компания wipon",
        "что делает wipon для бизнеса",
        "расскажите о деятельности wipon",
        "wipon какие решения предлагает",
        "автоматизация торговли от wipon",
    ],
    "products_company_goal_901": [
        "какая цель у компании wipon",
        "миссия wipon какая",
        "зачем нужен wipon бизнесу",
        "что хочет достичь wipon",
        "для чего создан wipon",
    ],
    "products_wipon_ecosystem_902": [
        "какие продукты выпускает wipon",
        "экосистема wipon что входит",
        "линейка продуктов wipon",
        "тис программа касса cashback",
        "что разрабатывает wipon",
    ],
    "products_target_audience_903": [
        "для кого подходит wipon",
        "кому нужен wipon",
        "какому бизнесу подойдёт wipon",
        "wipon для магазинов аптек кафе",
        "целевая аудитория wipon какая",
    ],
    "products_trust_wipon_904": [
        "почему можно доверять wipon",
        "сколько лет wipon на рынке",
        "с какого года работает wipon",
        "wipon надёжная компания",
        "опыт работы wipon",
    ],
    "products_advantages_905": [
        "преимущества wipon какие",
        "плюсы работы с wipon",
        "чем хорош wipon для бизнеса",
        "почему выбирают wipon",
        "выгода от wipon какая",
    ],
    "products_achievements_906": [
        "достижения компании wipon",
        "сколько клиентов у wipon",
        "партнёры wipon кто",
        "50 тысяч клиентов это про вас",
        "результаты wipon за годы работы",
    ],
    "products_coverage_907": [
        "где работает wipon география",
        "по всему казахстану wipon есть",
        "доставка wipon в какие города",
        "wipon обслуживает все регионы",
        "работаете ли вы в моём городе",
    ],
    "products_business_help_908": [
        "как wipon помогает бизнесу",
        "польза от wipon для предпринимателя",
        "wipon упрощает работу магазина",
        "что даёт wipon владельцу бизнеса",
        "как wipon делает учёт проще",
    ],
    "products_meat_shop_915": [
        "wipon для мясного магазина подойдёт",
        "программа для продажи мяса",
        "мясная лавка нужна касса",
        "учёт в мясном магазине",
        "wipon для мяса есть решение",
    ],
    "products_grocery_store_916": [
        "wipon для продуктового магазина",
        "программа для продуктов",
        "магазин продуктов касса учёт",
        "продуктовый wipon подходит",
        "автоматизация продуктового магазина",
    ],
    "products_clothing_store_917": [
        "wipon для магазина одежды",
        "бутик программа учёта",
        "учёт одежды по артикулам размерам",
        "магазин одежды касса",
        "wipon для бутика подойдёт",
    ],
    "products_minimarket_918": [
        "wipon для маленького минимаркета",
        "программа для минимаркета",
        "небольшой магазин wipon",
        "мини маркет автоматизация",
        "касса для минимаркета wipon",
    ],
    "products_household_store_919": [
        "wipon для магазина бытовой химии",
        "хозтовары программа учёта",
        "магазин хозяйственных товаров",
        "бытовая химия касса",
        "учёт хозтоваров wipon",
    ],
    "products_construction_store_920": [
        "wipon для строительного магазина",
        "стройматериалы учёт программа",
        "магазин строительных материалов",
        "касса для стройки",
        "wipon для стройматериалов",
    ],
    "products_flower_shop_921": [
        "wipon для магазина цветов",
        "цветочный магазин программа",
        "флористика касса учёт",
        "продажа цветов wipon",
        "учёт в цветочном магазине",
    ],
    "products_electronics_store_922": [
        "wipon для магазина электроники",
        "техника гаджеты учёт",
        "магазин электроники касса",
        "wipon для техники подойдёт",
        "учёт электроники программа",
    ],
    "products_kids_store_923": [
        "wipon для магазина детских товаров",
        "игрушки учёт программа",
        "детский магазин касса",
        "wipon для детских товаров",
        "учёт игрушек и детской одежды",
    ],
    "products_furniture_store_924": [
        "wipon для магазина мебели",
        "мебельный магазин программа",
        "салон мебели касса",
        "учёт мебели wipon",
        "wipon для мебельного подойдёт",
    ],
    "products_autoparts_store_925": [
        "wipon для автозапчастей",
        "магазин запчастей программа",
        "учёт запчастей wipon",
        "авто запчасти касса",
        "wipon для запчастей подойдёт",
    ],
    "products_jewelry_store_926": [
        "wipon для ювелирного магазина",
        "ювелирка программа учёта",
        "украшения золото серебро касса",
        "учёт ювелирных изделий",
        "wipon для ювелирки",
    ],
    "products_bookstore_927": [
        "wipon для книжного магазина",
        "книги учёт программа",
        "книжный касса продажи",
        "продажа книг wipon",
        "учёт книг в магазине",
    ],
    "products_cosmetics_store_928": [
        "wipon для магазина косметики",
        "косметика парфюмерия учёт",
        "бьюти магазин программа",
        "wipon для косметики подойдёт",
        "учёт косметики и парфюмерии",
    ],
    "products_construction_store_kz_929": [
        "құрылыс дүкеніне wipon жарай ма",
        "құрылыс материалдары бағдарлама",
        "стройматериалы қазақша wipon",
        "құрылыс дүкені касса",
        "құрылыс тауарларын есепке алу",
    ],
    "products_flower_shop_kz_930": [
        "гүл дүкеніне wipon",
        "гүлдер сату бағдарлама",
        "цветы қазақша wipon",
        "гүл дүкені касса",
        "гүлдер есебін жүргізу",
    ],
    "products_electronics_store_kz_931": [
        "электроника дүкеніне wipon",
        "техника дүкені бағдарлама",
        "электроника қазақша касса",
        "техника есебін жүргізу",
        "гаджеттер дүкені wipon",
    ],
    "products_kids_store_kz_932": [
        "балалар тауарлары дүкеніне wipon",
        "ойыншықтар бағдарлама",
        "детские товары қазақша",
        "балалар дүкені касса",
        "ойыншықтар есебін жүргізу",
    ],
    "products_furniture_store_kz_933": [
        "жиһаз дүкеніне wipon",
        "мебель қазақша бағдарлама",
        "жиһаз сату есебі",
        "жиһаз дүкені касса",
        "жиһаз тауарларын есепке алу",
    ],
    "products_autoparts_store_kz_934": [
        "автокөлік қосалқы бөлшектері дүкені",
        "автозапчасти қазақша wipon",
        "бөлшектер сату бағдарлама",
        "запчасти дүкені касса",
        "бөлшектер есебін жүргізу",
    ],
    "products_jewelry_store_kz_935": [
        "зергерлік дүкенге wipon",
        "зергерлік бұйымдар бағдарлама",
        "ювелирка қазақша касса",
        "зергерлік есебін жүргізу",
        "алтын күміс дүкені wipon",
    ],
    "products_bookstore_kz_936": [
        "кітап дүкеніне wipon",
        "кітаптар сату бағдарлама",
        "книги қазақша касса",
        "кітап есебін жүргізу",
        "кітап дүкені wipon жарай ма",
    ],
    "products_cosmetics_store_kz_937": [
        "косметика дүкеніне wipon",
        "косметика қазақша бағдарлама",
        "парфюмерия қазақша касса",
        "косметика есебін жүргізу",
        "сұлулық дүкені wipon",
    ],
    "products_coffee_shop_980": [
        "wipon для кофейни подойдёт",
        "кафе программа с рецептами",
        "учёт рецептов ингредиентов",
        "калькуляция для кафе",
        "кофейня нужна касса с рецептами",
    ],

    # ==================== SUPPORT ====================
    "support_phone_consultation_909": [
        "можно по телефону проконсультироваться",
        "есть горячая линия wipon",
        "позвоните мне пожалуйста",
        "хочу созвониться с менеджером",
        "нужна консультация по телефону",
    ],
    "support_phone_call_910": [
        "поговорить по телефону с вами",
        "можно созвониться",
        "хочу позвонить вам",
        "телефонный разговор нужен",
        "созвониться с консультантом",
    ],
    "support_callback_911": [
        "консультация через звонок возможна",
        "хочу консультацию по телефону",
        "организуйте мне звонок",
        "звонок от менеджера нужен",
        "свяжитесь со мной по телефону",
    ],
    "support_callback_request_912": [
        "перезвоните мне пожалуйста",
        "можете перезвонить",
        "нужен обратный звонок",
        "закажу обратный звонок",
        "хочу чтобы вы перезвонили",
    ],
    "support_phone_consult_913": [
        "проконсультируйте по телефону",
        "консультация по телефону возможна",
        "телефонная консультация нужна",
        "хочу консультацию голосом",
        "объясните по телефону",
    ],
    "support_contact_phone_914": [
        "как связаться по телефону",
        "контактный телефон какой",
        "номер для связи дайте",
        "телефон для консультации",
        "по какому номеру позвонить",
    ],

    # ==================== FISCAL ====================
    "fiscal_data_privacy_938": [
        "данные передаются в налоговую",
        "налоговая видит мои продажи",
        "данные уходят в кгд",
        "информация передаётся в налоговую",
        "мои данные попадут в налоговую",
    ],
    "fiscal_sales_visibility_939": [
        "налоговая будет видеть все продажи",
        "видит ли налоговая мой оборот",
        "продажи отправляются в налоговую",
        "налоговая узнает все мои продажи",
        "мои продажи видны налоговой",
    ],
    "fiscal_reports_privacy_940": [
        "отчёты уходят в налоговую",
        "мои отчёты передаются куда-то",
        "налоговая получает отчёты",
        "внутренние отчёты видит налоговая",
        "отчёты о продажах в налоговую",
    ],
    "fiscal_inventory_privacy_941": [
        "налоговая видит мой склад",
        "остатки передаются в налоговую",
        "склад товаров видит налоговая",
        "мой склад виден кгд",
        "налоговая знает мои остатки",
    ],
    "fiscal_product_data_942": [
        "данные по товарам в налоговую идут",
        "номенклатура передаётся в налоговую",
        "товары мои видит налоговая",
        "информация о товарах в кгд",
        "налоговая знает мой ассортимент",
    ],
    "fiscal_auto_send_943": [
        "продажи автоматически уходят в налоговую",
        "все продажи отправляются сами",
        "автоматическая отправка в налоговую",
        "данные сами передаются в кгд",
        "без моего ведома в налоговую уходит",
    ],
    "fiscal_data_privacy_kz_944": [
        "сату деректері мемлекеттік органдарға жіберіле ме",
        "деректер салық органдарына барады ма",
        "фискалды чектер қайда жіберіледі",
        "менің деректерім кімге барады",
        "мемлекеттік органдар не біледі",
    ],
    "fiscal_sales_visibility_kz_945": [
        "мемлекеттік органдар сатылымды көре ала ма",
        "барлық сатылым көрінеді ме оларға",
        "сатылымдарым кімге көрінеді",
        "мемлекет менің сатылымымды біле ме",
        "салық органдары сатылымды көреді ме",
    ],
    "fiscal_reports_privacy_kz_946": [
        "есеп-қисап мемлекеттік органдарға жіберіле ме",
        "ішкі есептер жіберіле ме",
        "менің есебім кімге барады",
        "есептер салық органдарына барады ма",
        "қандай есеп жіберіледі",
    ],
    "fiscal_inventory_privacy_kz_947": [
        "қоймадағы қалдықтар көрінеді ме оларға",
        "қойма деректері жіберіле ме",
        "менің қоймам кімге көрінеді",
        "мемлекет қойманы көреді ме",
        "тауар қалдықтары салыққа барады ма",
    ],
    "fiscal_product_data_kz_948": [
        "тауарлар туралы мәлімет беріле ме",
        "тауар деректері қайда жіберіледі",
        "номенклатура мемлекетке барады ма",
        "тауар тізімі көрінеді ме",
        "менің тауарларым кімге белгілі",
    ],
    "fiscal_auto_send_kz_949": [
        "барлық сатылым автоматты жіберіле ме",
        "автоматты түрде жіберу бар ма",
        "менің ведомымсыз жіберіле ме",
        "сатылым өздігінен кетеді ме",
        "автоматты жіберу қалай жұмыс істейді",
    ],

    # ==================== PRICING ====================
    "pricing_installment_950": [
        "есть рассрочка у вас",
        "рассрочка на оборудование возможна",
        "можно в рассрочку купить",
        "рассрочка wipon есть",
        "оплата в рассрочку доступна",
    ],
    "pricing_installment_tariff_951": [
        "тариф в рассрочку можно",
        "оборудование в рассрочку оформить",
        "взять в рассрочку программу",
        "рассрочка на тариф и оборудование",
        "тариф частями можно оплатить",
    ],
    "pricing_payment_parts_952": [
        "оплата частями возможна",
        "частями оплатить можно",
        "по частям оплачивать",
        "разбить оплату на части",
        "платить частями хочу",
    ],
    "pricing_equipment_installment_953": [
        "рассрочка при покупке оборудования есть",
        "оборудование в рассрочку купить",
        "купить оборудование в рассрочку",
        "кассу в рассрочку взять",
        "моноблок в рассрочку можно",
    ],
    "pricing_tariff_installment_954": [
        "оплата в рассрочку на тарифы есть",
        "тарифы в рассрочку оформить",
        "подписку в рассрочку можно",
        "тариф оплатить частями",
        "рассрочка на годовой тариф",
    ],
    "pricing_installment_kz_955": [
        "бөліп төлеу бар ма",
        "бөліп төлеуге болады ма",
        "рассрочка қазақша бар",
        "бөлшектеп төлеу мүмкін бе",
        "төлемді бөлуге болады ма",
    ],
    "pricing_tariff_installment_kz_956": [
        "тарифті бөліп төлеуге бола ма",
        "жабдықты бөліп төлеу бар ма",
        "бағдарлама бөліп төлеу",
        "тариф рассрочка қазақша",
        "жабдық бөлшектеп төлеу",
    ],
    "pricing_kaspi_installment_kz_957": [
        "kaspi арқылы бөліп төлеу бар ма",
        "каспи рассрочка бар",
        "каспи бөліп төлеу мүмкін бе",
        "kaspi red арқылы төлеу",
        "каспи арқылы сатып алу",
    ],
    "pricing_equipment_installment_kz_958": [
        "жабдықты бөліп төлеуге алуға бола ма",
        "wipon жабдық рассрочка",
        "кассаны бөліп төлеу",
        "моноблок бөліп төлеу",
        "жабдық бөлшектеп сатып алу",
    ],
    "pricing_tariff_installment_kz_959": [
        "тарифтерге бөліп төлеу бар ма",
        "тариф бөліп төлеу қалай",
        "жылдық тариф рассрочка",
        "тариф бөлшектеп төлеу",
        "подписка бөліп төлеу",
    ],
    "pricing_tariffs_store_979": [
        "тарифы для магазина какие есть",
        "какие тарифы у wipon",
        "тарифы wipon для розницы",
        "mini lite standard pro что это",
        "сколько стоят тарифы wipon",
    ],
    "pricing_tariff_pharmacy_981": [
        "тариф для аптеки какой выбрать",
        "какой тариф подойдёт аптеке",
        "аптека какой тариф лучше",
        "тарифы wipon для аптеки",
        "аптеке нужен какой тариф",
    ],
    "pricing_tariff_minimarket_985": [
        "тарифы для минимаркета какие",
        "минимаркет какой тариф взять",
        "какой тариф для минимаркета лучше",
        "тариф wipon для минимаркета",
        "минимаркету нужен какой тариф",
    ],
    "pricing_tariff_meat_shop_986": [
        "тариф для мясного магазина",
        "мясной магазин какой тариф",
        "какой тариф для мясной лавки",
        "мясной тариф wipon",
        "тариф для продажи мяса",
    ],
    "pricing_tariff_grocery_987": [
        "тарифы для продуктового магазина",
        "продуктовый какой тариф нужен",
        "какой тариф для продуктового",
        "тариф wipon продуктовый",
        "продуктовому магазину тариф",
    ],
    "pricing_tariff_construction_988": [
        "тариф для строительного магазина",
        "строительный магазин какой тариф",
        "какой тариф для стройматериалов",
        "тариф wipon для стройки",
        "стройматериалы тариф какой",
    ],
    "pricing_tariff_clothing_989": [
        "тарифы для магазина одежды",
        "магазин одежды какой тариф",
        "какой тариф для бутика",
        "одежда тариф wipon",
        "бутику нужен какой тариф",
    ],
    "pricing_tariff_cosmetics_990": [
        "тариф для магазина косметики",
        "косметика какой тариф выбрать",
        "какой тариф для косметики",
        "тариф wipon косметика",
        "парфюмерия тариф какой",
    ],
    "pricing_tariff_autoparts_991": [
        "тарифы для магазина автозапчастей",
        "автозапчасти какой тариф",
        "какой тариф для запчастей",
        "тариф wipon запчасти",
        "автомагазин тариф какой",
    ],

    # ==================== EQUIPMENT ====================
    "equipment_beer_shop_960": [
        "пивной магазин какое оборудование",
        "оборудование для пива",
        "пивная точка касса какая",
        "касса для пивного магазина",
        "пиво продажа оборудование",
    ],
    "equipment_meat_shop_961": [
        "мясной магазин какое оборудование нужно",
        "оборудование для мясного магазина",
        "мясо весы касса что взять",
        "касса для мясной лавки",
        "мясной оборудование комплект",
    ],
    "equipment_minimarket_962": [
        "оборудование для минимаркета какое",
        "минимаркет комплект оборудования",
        "касса для минимаркета что выбрать",
        "минимаркет оборудование wipon",
        "небольшой магазин оборудование",
    ],
    "equipment_grocery_963": [
        "продуктовый магазин оборудование какое",
        "оборудование для продуктового",
        "касса для продуктов что взять",
        "продуктовый комплект wipon",
        "продукты оборудование рекомендация",
    ],
    "equipment_clothing_964": [
        "магазин одежды оборудование какое",
        "оборудование для бутика одежды",
        "касса для одежды что выбрать",
        "бутик оборудование wipon",
        "одежда магазин касса какая",
    ],
    "equipment_construction_965": [
        "строительный магазин оборудование какое",
        "оборудование для стройматериалов",
        "касса для стройки что взять",
        "стройка комплект wipon",
        "стройматериалы оборудование",
    ],
    "equipment_cosmetics_966": [
        "магазин косметики оборудование какое",
        "оборудование для косметики",
        "касса для косметики что выбрать",
        "косметика комплект wipon",
        "парфюмерия оборудование",
    ],
    "equipment_autoparts_967": [
        "магазин автозапчастей оборудование какое",
        "оборудование для запчастей",
        "касса для автозапчастей",
        "запчасти комплект wipon",
        "автомагазин оборудование",
    ],
    "equipment_flower_shop_968": [
        "цветочный магазин оборудование какое",
        "оборудование для цветов",
        "касса для цветочного",
        "цветы комплект wipon",
        "флористика оборудование",
    ],
    "equipment_jewelry_969": [
        "ювелирный магазин оборудование какое",
        "оборудование для ювелирки",
        "касса для ювелирного",
        "ювелирка комплект wipon",
        "золото серебро оборудование",
    ],
    "equipment_pharmacy_970": [
        "аптека оборудование какое нужно",
        "оборудование для аптеки",
        "касса для аптеки что взять",
        "аптека комплект wipon",
        "аптечное оборудование",
    ],
    "equipment_coffee_shop_971": [
        "кофейня оборудование какое",
        "оборудование для кафе",
        "касса для кофейни",
        "кафе оборудование wipon",
        "кофейня касса нужна",
    ],
    "equipment_household_972": [
        "магазин бытовой химии оборудование какое",
        "оборудование для хозтоваров",
        "касса для бытовой химии",
        "хозтовары комплект wipon",
        "бытовая химия оборудование",
    ],
    "equipment_furniture_973": [
        "мебельный салон оборудование какое",
        "оборудование для мебели",
        "касса для мебельного",
        "мебель комплект wipon",
        "салон мебели оборудование",
    ],
    "equipment_bookstore_974": [
        "книжный магазин оборудование какое",
        "оборудование для книг",
        "касса для книжного",
        "книги комплект wipon",
        "книжный оборудование рекомендация",
    ],
    "equipment_kids_store_975": [
        "детский магазин оборудование какое",
        "оборудование для детских товаров",
        "касса для детского магазина",
        "детские товары комплект wipon",
        "игрушки оборудование",
    ],
    "equipment_electronics_976": [
        "магазин электроники оборудование какое",
        "оборудование для техники",
        "касса для электроники",
        "техника комплект wipon",
        "гаджеты оборудование",
    ],
    "equipment_village_store_977": [
        "сельский магазин оборудование какое",
        "оборудование для села деревни",
        "касса для сельского магазина",
        "деревня магазин wipon",
        "село оборудование какое",
    ],
    "equipment_market_978": [
        "рынок оборудование какое",
        "павильон оборудование",
        "касса для рынка",
        "рынок комплект wipon",
        "павильон касса какая",
    ],
    "equipment_scales_auto_price_992": [
        "весы автоматически определяют цену",
        "весы сами считают цену товара",
        "вручную вводить вес нужно",
        "весы передают цену на кассу",
        "автоматический подсчёт цены по весу",
    ],
    "equipment_247_operation_993": [
        "магазин круглосуточно касса выдержит",
        "касса без перезагрузки работает",
        "круглосуточная работа моноблока",
        "24 часа касса работает",
        "ночью касса работает стабильно",
    ],
    "equipment_cold_conditions_994": [
        "холодное помещение касса работает",
        "неотапливаемое помещение оборудование",
        "склад павильон холод касса",
        "зимой в павильоне касса работает",
        "мороз оборудование выдержит",
    ],
    "equipment_offline_mode_995": [
        "касса без интернета работает",
        "офлайн режим у кассы есть",
        "работа без сети интернет",
        "нет интернета касса пробивает",
        "чеки офлайн пробиваются",
    ],
    "equipment_product_photos_996": [
        "фотографии товаров можно добавить",
        "фото товаров в программе",
        "добавить фото к товару",
        "картинки товаров в системе",
        "изображения товаров есть",
    ],
    "equipment_training_997": [
        "обучение входит в стоимость оборудования",
        "обучение при покупке оборудования",
        "бесплатное обучение есть",
        "научите работать с кассой",
        "обучение как пользоваться программой",
    ],

    # ==================== REGIONS ====================
    "regions_almaty_998": [
        "бизнес в алматы есть предложение",
        "для алматы что предлагаете",
        "алматы wipon работает",
        "что для алматы есть",
        "в алматы доставка и настройка",
    ],
    "regions_astana_999": [
        "бизнес в астане есть предложение",
        "для астаны что предлагаете",
        "астана wipon работает",
        "предприниматели астана wipon",
        "в астане доставка и настройка",
    ],
    "regions_shymkent_1000": [
        "магазины в шымкенте есть предложение",
        "для шымкента что предлагаете",
        "шымкент wipon работает",
        "что для шымкента есть",
        "в шымкенте доставка и настройка",
    ],
}

def test_section(topic: str, queries: list) -> dict:
    """Тестирует одну секцию с несколькими запросами."""
    results = {"topic": topic, "passed": 0, "failed": 0, "failures": []}

    for query in queries:
        matches = retriever.search(query, top_k=3)
        found = False
        positions = []

        for i, match in enumerate(matches):
            match_topic = match.section.topic if match else 'unknown'
            positions.append(f"{i+1}:{match_topic[:30]}")
            if match_topic == topic:
                found = True
                break

        if found:
            results["passed"] += 1
        else:
            results["failed"] += 1
            results["failures"].append({
                "query": query,
                "got": positions
            })

    return results

def main():
    print("=" * 70)
    print("ТЕСТИРОВАНИЕ СЕКЦИЙ 900-1000")
    print("=" * 70)

    total_passed = 0
    total_failed = 0
    failed_sections = []

    for topic, queries in TEST_QUERIES.items():
        result = test_section(topic, queries)
        total_passed += result["passed"]
        total_failed += result["failed"]

        if result["failed"] > 0:
            failed_sections.append(result)
            status = f"✗ {topic}: {result['passed']}/{len(queries)} ({result['passed']*100//len(queries)}%)"
            print(status)
            for failure in result["failures"]:
                print(f"   ✗ '{failure['query']}' → {failure['got']}")
        else:
            print(f"✓ {topic}: {len(queries)}/{len(queries)} (100%)")

    total = total_passed + total_failed
    accuracy = total_passed / total * 100 if total > 0 else 0

    print("\n" + "=" * 70)
    print(f"ИТОГО: {total_passed}/{total} ({accuracy:.1f}%)")
    print(f"Секций с ошибками: {len(failed_sections)}")
    print("=" * 70)

    if failed_sections:
        print("\nСЕКЦИИ ТРЕБУЮЩИЕ ДОРАБОТКИ:\n")
        for section in sorted(failed_sections, key=lambda x: x["failed"], reverse=True):
            print(f"{section['topic']} ({section['failed']} ошибок):")
            for failure in section["failures"]:
                print(f"  - {failure['query']}")
            print()

if __name__ == "__main__":
    main()
