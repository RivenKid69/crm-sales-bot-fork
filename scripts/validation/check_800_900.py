#!/usr/bin/env python3
"""
Тестирование секций 800-900 базы знаний.
Минимум 5 уникальных клиентских запросов на каждую секцию.
"""

import sys
sys.path.insert(0, 'src')

from knowledge.retriever import CascadeRetriever

retriever = CascadeRetriever(use_embeddings=False)

# Тестовые запросы для секций 800-900 (имитация клиентов)
# Используем АКТУАЛЬНЫЕ названия topics из YAML файлов
TEST_QUERIES = {
    # ==================== PRODUCTS ====================
    "products_small_business_800": [
        "решение для начинающего предпринимателя",
        "касса для небольшой точки",
        "бюджетный вариант для старта",
        "программа для микробизнеса",
        "доступное решение для маленького магазина",
    ],
    "products_wipon_overview_801": [
        "расскажите подробнее про программу wipon",
        "что входит в систему wipon",
        "какие функции есть в wipon для ип",
        "wipon для товарищества с ограниченной ответственностью подойдёт",
        "хочу узнать про автоматизацию продаж и склада",
    ],
    "products_universal_categories_803": [
        "у меня хлеб и стройматериалы в одном магазине подойдёт",
        "можно разные категории товаров вести",
        "программа универсальная для любых товаров",
        "продаю и продукты и хозтовары одновременно",
        "смешанный ассортимент товаров как вести учёт",
    ],
    "products_beauty_salon_kz_858": [
        "шаштаразға wipon бағдарламасы бар ма",
        "сұлулық салонына қандай бағдарлама керек",
        "қызмет түрлерін енгізуге бола ма",
        "салон красоты үшін wipon жарай ма",
        "шаштараз чек беру керек пе",
    ],

    # ==================== INVENTORY ====================
    "inventory_loss_tracking_802": [
        "как отслеживать потери на складе",
        "учёт недостач и списаний",
        "фиксировать порчу товаров",
        "контроль потерь в магазине",
        "списание убытков как вести",
    ],

    # ==================== STABILITY ====================
    "stability_offline_work_804": [
        "интернет часто пропадает как работать",
        "что делать если отключился интернет",
        "касса будет работать без связи",
        "офлайн режим есть в программе",
        "продажи без интернета возможны",
    ],
    "stability_offline_mode_807": [
        "программа работает без интернета",
        "пробивать чеки офлайн можно",
        "нет интернета а нужно продавать",
        "синхронизация после восстановления интернета",
        "чеки офлайн потом отправляются",
    ],

    # ==================== SUPPORT ====================
    "support_easy_to_learn_805": [
        "легко ли научиться работать с программой",
        "сложно освоить wipon",
        "обучение сколько времени занимает",
        "быстро ли разберусь в системе",
        "программа простая в освоении",
    ],
    "support_phone_consultation_909": [
        "можно по телефону проконсультироваться",
        "есть горячая линия для клиентов",
        "позвонить и спросить про программу",
        "консультация по телефону доступна",
        "номер телефона для связи",
    ],

    # ==================== MOBILE ====================
    "mobile_abroad_access_806": [
        "уехал за границу как проверить выручку",
        "из другой страны можно зайти",
        "буду в отпуске хочу следить за магазином",
        "доступ к данным из любой точки мира",
        "за рубежом смотреть продажи",
    ],

    # ==================== EMPLOYEES ====================
    "employees_limit_808": [
        "сколько сотрудников можно добавить в лайт",
        "лимит на кассиров в тарифе",
        "в стандарте есть ограничение по сотрудникам",
        "до 3 человек на кассу это какой тариф",
        "без ограничений сотрудники какой тариф нужен",
    ],
    "employees_cashier_control_812": [
        "как контролировать работу кассиров",
        "видно кто какую продажу сделал",
        "следить за действиями продавцов",
        "журнал действий кассира есть",
        "кто изменил цену на товар",
    ],

    # ==================== FEATURES ====================
    "features_send_receipt_whatsapp_809": [
        "отправить чек клиенту в ватсап",
        "чек на whatsapp можно",
        "электронный чек в мессенджер",
        "скинуть чек на телефон покупателя",
        "whatsapp отправка чека",
    ],
    "features_return_product_810": [
        "как оформить возврат товара",
        "клиент хочет вернуть покупку",
        "возврат денег через кассу",
        "оформление возврата в программе",
        "отмена продажи и возврат",
    ],
    "features_multiple_locations_811": [
        "у меня несколько точек как вести",
        "две торговые точки в одной программе",
        "управлять несколькими магазинами",
        "сеть магазинов одна система",
        "филиалы в разных местах",
    ],

    # ==================== EQUIPMENT ====================
    "equipment_scanner_connect_813": [
        "как подключить сканер к кассе",
        "сканер штрихкодов подключение",
        "настройка сканера wipon",
        "подключить сканер к моноблоку",
        "сканер не работает как настроить",
    ],
    "equipment_monoblocks_models_815": [
        "какие моноблоки есть в наличии",
        "модели моноблоков wipon",
        "ассортимент моноблоков",
        "моноблоки какие бывают",
        "линейка моноблоков wipon",
    ],
    "equipment_wipon_5in1_816": [
        "wipon 5 в 1 что это",
        "касса 5 в 1",
        "всё в одном устройстве wipon",
        "моноблок 5в1 цена",
        "касса со встроенным сканером принтером",
    ],
    "equipment_scales_labels_817": [
        "весы с печатью этикеток",
        "весы с принтером этикеток",
        "весы печатают ценники",
        "весы для взвешивания и печати",
        "этикеточные весы для магазина",
    ],
    "equipment_scanner_models_818": [
        "какие сканеры есть в наличии",
        "модели сканеров wipon",
        "ассортимент сканеров штрихкодов",
        "сканеры какие бывают",
        "линейка сканеров",
    ],
    "equipment_printer_models_819": [
        "какие принтеры чеков есть",
        "модели чековых принтеров",
        "принтеры для чеков какие",
        "ассортимент принтеров",
        "термопринтеры какие модели",
    ],
    "equipment_kassa_recommendation_820": [
        "какую кассу посоветуете",
        "рекомендация по кассе",
        "что выбрать из касс",
        "какая касса лучше для магазина",
        "посоветуйте кассу для розницы",
    ],
    "equipment_kit_recommendation_821": [
        "какой комплект оборудования нужен",
        "что входит в набор для кассы",
        "полный комплект оборудования",
        "минимальный набор для начала работы",
        "что купить для кассы полный набор",
    ],
    "equipment_scanner_recommendation_822": [
        "какой сканер посоветуете",
        "рекомендация по сканеру штрихкодов",
        "что выбрать из сканеров",
        "какой сканер лучше для магазина",
        "посоветуйте сканер для продуктового",
    ],
    "equipment_monoblock_recommendation_823": [
        "какой моноблок посоветуете",
        "рекомендация по моноблоку",
        "что выбрать из моноблоков",
        "какой моноблок лучше",
        "посоветуйте моноблок для магазина",
    ],
    "equipment_scales_recommendation_824": [
        "какие весы посоветуете",
        "рекомендация по весам",
        "что выбрать из весов",
        "какие весы лучше для магазина",
        "посоветуйте весы для продуктового",
    ],
    "equipment_printer_recommendation_825": [
        "какой принтер чеков посоветуете",
        "рекомендация по принтеру",
        "что выбрать из принтеров",
        "какой принтер лучше",
        "посоветуйте принтер для чеков",
    ],
    "equipment_start_recommendation_826": [
        "с чего начать покупку оборудования",
        "что нужно для старта работы",
        "минимальный набор для начала",
        "первое оборудование для магазина",
        "стартовый комплект оборудования",
    ],
    "equipment_compact_kassa_827": [
        "компактная касса для маленькой точки",
        "небольшая касса для ларька",
        "касса минимального размера",
        "маленькая касса занимает мало места",
        "касса для ограниченного пространства",
    ],
    "equipment_customer_display_828": [
        "дисплей для покупателя нужен",
        "экран чтобы клиент видел сумму",
        "монитор для клиента на кассе",
        "дисплей покупателя цена",
        "второй экран для клиента",
    ],
    "equipment_high_traffic_829": [
        "касса для большого потока клиентов",
        "оборудование для высокой проходимости",
        "касса для супермаркета",
        "быстрая касса для большого магазина",
        "оборудование для большой точки",
    ],
    "equipment_wireless_scanner_830": [
        "беспроводной сканер штрихкодов",
        "сканер без провода bluetooth",
        "сканер с аккумулятором",
        "мобильный сканер для инвентаризации",
        "сканер на батарейках",
    ],
    "equipment_cash_drawer_831": [
        "денежный ящик к кассе",
        "ящик для денег купить",
        "касса с денежным ящиком",
        "автоматический денежный ящик",
        "куда складывать наличку",
    ],
    "equipment_self_service_scales_832": [
        "весы самообслуживания для магазина",
        "весы где покупатель сам взвешивает",
        "весы для покупателей",
        "весы самообслуживания цена",
        "весы для супермаркета самообслуживание",
    ],
    "equipment_modern_kassa_833": [
        "современная касса для магазина",
        "новейшее оборудование для торговли",
        "касса последнего поколения",
        "продвинутая касса с функциями",
        "инновационная касса wipon",
    ],
    "equipment_full_kit_834": [
        "полный комплект оборудования цена",
        "всё оборудование под ключ",
        "готовый набор для автоматизации",
        "комплексное решение с оборудованием",
        "купить полный набор для кассы",
    ],
    "equipment_budget_alternative_843": [
        "бюджетная альтернатива дорогому оборудованию",
        "дешевле чем моноблок что есть",
        "недорогое решение вместо дорогого",
        "экономный вариант оборудования",
        "что подешевле вместо моноблока",
    ],
    "equipment_budget_monoblock_844": [
        "бюджетный моноблок есть",
        "моноблок подешевле какой",
        "недорогой моноблок для старта",
        "моноблок эконом класса",
        "дешёвый моноблок wipon",
    ],
    "equipment_budget_scales_846": [
        "бюджетные весы для магазина",
        "весы подешевле какие",
        "недорогие весы для продуктового",
        "весы эконом класса",
        "дешёвые торговые весы",
    ],
    "equipment_budget_scanner_847": [
        "бюджетный сканер штрихкодов",
        "сканер подешевле какой",
        "недорогой сканер для кассы",
        "сканер эконом класса",
        "дешёвый сканер для магазина",
    ],
    "equipment_pos_duo_alternative_849": [
        "альтернатива pos duo",
        "что вместо pos duo",
        "дешевле pos duo есть",
        "аналог pos duo",
        "замена pos duo",
    ],
    "equipment_standard_alternative_850": [
        "альтернатива стандартному оборудованию",
        "вместо стандартного что есть",
        "замена стандартного набора",
        "другой вариант стандартного",
        "аналог стандартного комплекта",
    ],
    "equipment_wipon_quadro_857": [
        "wipon quadro что это",
        "квадро моноблок",
        "wipon quadro характеристики",
        "quadro цена",
        "моноблок квадро wipon",
    ],
    "equipment_scales_monoblock_kz_859": [
        "таразы моноблокпен қосу",
        "таразы wipon қазақша",
        "электронды таразы қосу",
        "таразы бағдарламамен байланыстыру",
        "таразы моноблок интеграция",
    ],
    "equipment_scales_monoblock_860": [
        "весы подключить к моноблоку",
        "интеграция весов с моноблоком",
        "весы и моноблок вместе",
        "настройка весов с моноблоком",
        "как связать весы и кассу",
    ],
    "equipment_monoblock_printer_861": [
        "моноблок со встроенным принтером",
        "принтер в моноблоке",
        "моноблок с печатью чеков",
        "принтер встроен в кассу",
        "моноблок без отдельного принтера",
    ],
    "equipment_monoblock_scanner_862": [
        "моноблок со встроенным сканером",
        "сканер в моноблоке",
        "моноблок с встроенным сканером штрихкодов",
        "сканер встроен в кассу",
        "моноблок без отдельного сканера",
    ],
    "equipment_combo_863": [
        "комбинированное оборудование",
        "всё в одном касса",
        "комбо оборудование wipon",
        "универсальная касса всё включено",
        "оборудование два в одном",
    ],
    "equipment_combo_list_864": [
        "список комбинированного оборудования",
        "какие есть комбо устройства",
        "перечень оборудования всё в одном",
        "ассортимент комбо касс",
        "линейка комбинированных устройств",
    ],

    # ==================== INTEGRATIONS ====================
    "integrations_marking_814": [
        "интеграция с маркировкой товаров",
        "сканировать маркировку через wipon",
        "работа с честным знаком",
        "маркировка интегрирована в систему",
        "поддержка маркировки в программе",
    ],
    "integrations_bank_851": [
        "интеграция с банками какими",
        "какие банки подключены",
        "банковская интеграция wipon",
        "с какими банками работаете",
        "банки для оплаты картой",
    ],
    "integrations_which_banks_852": [
        "какие банки поддерживаются",
        "список банков для интеграции",
        "каспи халык жусан интеграция",
        "все банки казахстана",
        "поддержка казахстанских банков",
    ],
    "integrations_terminal_no_manual_853": [
        "терминал без ручного ввода суммы",
        "автоматическая передача суммы на терминал",
        "терминал сам получает сумму",
        "не нужно вводить сумму на терминале",
        "интеграция терминала без ручного ввода",
    ],
    "integrations_bank_benefits_854": [
        "преимущества банковской интеграции",
        "зачем интеграция с банками",
        "польза от подключения банка",
        "что даёт интеграция с банком",
        "выгода от банковской интеграции",
    ],
    "integrations_smartphone_payment_855": [
        "оплата со смартфона клиента",
        "nfc оплата телефоном",
        "apple pay google pay принимать",
        "бесконтактная оплата телефоном",
        "оплата смартфоном через терминал",
    ],

    # ==================== PRICING ====================
    "pricing_two_locations_835": [
        "цена за две торговые точки",
        "тариф на два магазина",
        "сколько стоит подключить 2 точки",
        "скидка за несколько точек",
        "стоимость для двух филиалов",
    ],
    "pricing_expansion_plan_836": [
        "планирую расширяться какой тариф",
        "открываю ещё магазины что выбрать",
        "тариф для растущего бизнеса",
        "подключить дополнительные точки потом",
        "масштабирование бизнеса тариф",
    ],
    "pricing_pro_cheaper_845": [
        "есть тариф подешевле чем про",
        "альтернатива тарифу про",
        "что-то дешевле про тарифа",
        "стандарт вместо про можно",
        "бюджетная замена про тарифу",
    ],
    "pricing_pro_installment_848": [
        "рассрочка на тариф про",
        "оплата тарифа про частями",
        "про в рассрочку можно",
        "рассрочка без переплаты тариф",
        "тариф про оплата по частям",
    ],

    # ==================== TIS ====================
    "tis_consultation_837": [
        "консультация по тис",
        "нужна помощь с тис",
        "объясните про тис",
        "вопросы по тис",
        "хочу узнать про тис",
    ],
    "tis_benefits_2026_838": [
        "преимущества тис в 2026",
        "зачем тис в 2026 году",
        "выгода от тис 2026",
        "польза тис для бизнеса 2026",
        "что даёт тис в 2026",
    ],
    "tis_work_2026_839": [
        "как работает тис в 2026",
        "тис работа в 2026 году",
        "функционал тис 2026",
        "что изменится в тис 2026",
        "тис 2026 как пользоваться",
    ],
    "tis_rates_2026_840": [
        "тарифы тис 2026",
        "цены на тис 2026",
        "стоимость тис в 2026",
        "сколько стоит тис 2026",
        "расценки тис 2026",
    ],
    "tis_changes_2026_841": [
        "изменения в тис 2026",
        "что нового в тис 2026",
        "обновления тис 2026",
        "тис 2026 новые правила",
        "законодательство тис 2026",
    ],
    "tis_branches_2026_842": [
        "тис для филиалов 2026",
        "несколько точек тис 2026",
        "тис на несколько магазинов",
        "тис для сети 2026",
        "филиалы и тис",
    ],
    "tis_kz_856": [
        "тіс жүйесі туралы",
        "тіс қосылу қалай",
        "тіс бағасы қанша",
        "тіс қазақша",
        "тіс жүйесі ақпарат",
    ],

    # ==================== REGIONS ====================
    "regions_delivery_kz_871": [
        "неше күнде жеткізесіздер",
        "оборудование жеткізу мерзімі",
        "қашан аламын тапсырысты",
        "доставка казахский язык",
        "жеткізу уақыты қанша",
    ],
    "regions_delivery_aktau_872": [
        "актауға жеткізу бар ма",
        "доставка в актау возможна",
        "актау оборудование доставить",
        "актау қаласына жеткізу",
        "мангистау область доставка",
    ],
    "regions_delivery_aktobe_873": [
        "актобеге жеткізу бар ма",
        "доставка в актобе возможна",
        "актобе оборудование доставить",
        "ақтөбеге жеткізу",
        "актюбинск доставка",
    ],
    "regions_delivery_almaty_874": [
        "алматыға жеткізу бар ма",
        "доставка в алматы когда",
        "алматы оборудование привезти",
        "алматы қаласына жеткізу",
        "южная столица доставка",
    ],
    "regions_delivery_astana_875": [
        "астанаға жеткізу бар ма",
        "доставка в астану когда",
        "астана нур-султан оборудование",
        "астана қаласына жеткізу",
        "столица доставка кассы",
    ],
    "regions_delivery_atyrau_876": [
        "атырауға жеткізу бар ма",
        "доставка в атырау возможна",
        "атырау оборудование доставить",
        "атырау қаласына жеткізу",
        "западный казахстан атырау",
    ],
    "regions_delivery_karaganda_877": [
        "қарағандыға жеткізу бар ма",
        "доставка в караганду когда",
        "караганда оборудование доставить",
        "қарағанды қаласына жеткізу",
        "карагандинская область",
    ],
    "regions_delivery_kostanay_878": [
        "қостанайға жеткізу бар ма",
        "доставка в костанай возможна",
        "костанай оборудование доставить",
        "қостанай қаласына жеткізу",
        "северный казахстан костанай",
    ],
    "regions_delivery_kyzylorda_879": [
        "қызылордаға жеткізу бар ма",
        "доставка в кызылорду возможна",
        "кызылорда оборудование доставить",
        "қызылорда қаласына жеткізу",
        "кызылординская область",
    ],
    "regions_delivery_pavlodar_880": [
        "павлодарға жеткізу бар ма",
        "доставка в павлодар когда",
        "павлодар оборудование доставить",
        "павлодар қаласына жеткізу",
        "павлодарская область",
    ],
    "regions_delivery_petropavlovsk_881": [
        "петропавлға жеткізу бар ма",
        "доставка в петропавловск когда",
        "петропавловск скр оборудование",
        "солтүстік қазақстан",
        "северо-казахстанская область",
    ],
    "regions_delivery_semey_882": [
        "семейге жеткізу бар ма",
        "доставка в семей когда",
        "семей семипалатинск оборудование",
        "семей қаласына жеткізу",
        "восточный казахстан семей",
    ],
    "regions_delivery_taraz_883": [
        "таразға жеткізу бар ма",
        "доставка в тараз когда",
        "тараз жамбыл оборудование",
        "тараз қаласына жеткізу",
        "жамбылская область тараз",
    ],
    "regions_delivery_uralsk_884": [
        "орал қаласына жеткізу бар ма",
        "доставка в уральск когда",
        "уральск зко оборудование",
        "орал қаласына жеткізу",
        "западно-казахстанская область",
    ],
    "regions_delivery_ustkam_885": [
        "өскеменге жеткізу бар ма",
        "доставка в усть-каменогорск когда",
        "усть-каменогорск вко оборудование",
        "өскемен қаласына жеткізу",
        "оскемен восточный казахстан",
    ],
    "regions_delivery_shymkent_886": [
        "шымкентке жеткізу бар ма",
        "доставка в шымкент когда",
        "шымкент туркестан оборудование",
        "шымкент қаласына жеткізу",
        "южный казахстан шымкент",
    ],
    "regions_delivery_all_kz_887": [
        "по всему казахстану доставляете",
        "в любой город рк доставка",
        "вся страна охвачена доставкой",
        "бүкіл қазақстанға жеткізу",
        "доставка во все регионы",
    ],
    "regions_delivery_time_888": [
        "сколько дней ждать доставку",
        "срок доставки оборудования",
        "когда получу заказ",
        "время доставки кассы",
        "как быстро привезёте",
    ],
    "regions_delivery_cities_889": [
        "в какие города доставка есть",
        "список городов доставки",
        "куда доставляете оборудование",
        "все города где есть доставка",
        "география доставки wipon",
    ],
    "regions_delivery_fast_890": [
        "быстрая доставка в какие города",
        "срочная доставка возможна",
        "экспресс доставка оборудования",
        "побыстрее получить кассу",
        "самая быстрая доставка куда",
    ],
    "regions_delivery_cost_891": [
        "сколько стоит доставка оборудования",
        "доставка бесплатная или платная",
        "цена доставки в регионы",
        "стоимость отправки кассы",
        "тариф на доставку",
    ],
    "regions_delivery_track_892": [
        "отслеживать доставку можно",
        "трекинг номер дадите",
        "где моя посылка",
        "статус доставки как узнать",
        "отследить заказ",
    ],
    "regions_delivery_pickup_893": [
        "самовывоз из офиса можно",
        "забрать самому оборудование",
        "приехать в офис и забрать",
        "без доставки забрать",
        "откуда можно забрать кассу",
    ],

    # ==================== OTHER ====================
    "competitors_umag_865": [
        "чем вы лучше умаг",
        "сравнение wipon и umag",
        "почему не umag а wipon",
        "отличия от юмаг",
        "wipon против umag",
    ],
    "competitors_umag_switch_866": [
        "хочу перейти с umag на вас",
        "миграция с умаг на wipon",
        "сменить юмаг на wipon",
        "у меня umag хочу к вам",
        "перенос данных с umag",
    ],
    "competitors_beksar_867": [
        "чем вы лучше бексар",
        "сравнение wipon и beksar",
        "почему не beksar а wipon",
        "отличия от бексар",
        "wipon против beksar",
    ],
    "competitors_1c_868": [
        "почему wipon а не 1с",
        "сравнение wipon и 1c",
        "лучше чем 1с чем",
        "зачем wipon если есть 1с",
        "wipon против 1с",
    ],
    "competitors_paloma_869": [
        "чем вы лучше paloma",
        "сравнение wipon и paloma",
        "перейти с палома на wipon",
        "отличия от paloma",
        "wipon против paloma",
    ],
    "competitors_general_870": [
        "почему стоит выбрать wipon",
        "преимущества wipon перед другими",
        "чем wipon лучше конкурентов",
        "зачем именно wipon",
        "уникальность wipon",
    ],
    "company_about_894": [
        "расскажите о компании wipon",
        "кто такие wipon",
        "история компании wipon",
        "wipon что за компания",
        "информация о wipon",
    ],
    "company_experience_895": [
        "сколько лет работает wipon",
        "давно ли на рынке wipon",
        "опыт работы компании wipon",
        "когда была основана wipon",
        "wipon сколько лет на рынке",
    ],
    "company_clients_896": [
        "сколько клиентов у wipon",
        "кто пользуется wipon",
        "клиентская база wipon",
        "популярность wipon в казахстане",
        "много ли клиентов у вас",
    ],
    "company_offices_897": [
        "где находятся офисы wipon",
        "адрес офиса wipon",
        "представительства wipon в городах",
        "филиалы wipon где",
        "офис wipon в алматы астана",
    ],
    "company_team_898": [
        "сколько сотрудников в wipon",
        "команда wipon какая",
        "кто работает в wipon",
        "специалисты wipon",
        "размер команды wipon",
    ],
    "company_trust_899": [
        "можно ли доверять wipon",
        "надёжная ли компания wipon",
        "wipon проверенная компания",
        "стоит ли доверять wipon",
        "wipon официальный оператор",
    ],
    "company_legal_900": [
        "wipon работает официально",
        "есть ли договор при покупке",
        "юридическое лицо wipon",
        "бин wipon какой",
        "официальный договор заключаете",
    ],
}

def test_section(topic: str, queries: list) -> dict:
    """Тестирует одну секцию с несколькими запросами."""
    results = {"topic": topic, "passed": 0, "failed": 0, "failures": []}

    for query in queries:
        matches = retriever.search(query, top_k=3)
        found = False
        positions = []

        for i, match in enumerate(matches):
            match_topic = match.section.topic if match else 'unknown'
            positions.append(f"{i+1}:{match_topic[:30]}")
            if match_topic == topic:
                found = True
                break

        if found:
            results["passed"] += 1
        else:
            results["failed"] += 1
            results["failures"].append({
                "query": query,
                "got": positions
            })

    return results

def main():
    print("=" * 70)
    print("ТЕСТИРОВАНИЕ СЕКЦИЙ 800-900")
    print("=" * 70)

    total_passed = 0
    total_failed = 0
    failed_sections = []

    for topic, queries in TEST_QUERIES.items():
        result = test_section(topic, queries)
        total_passed += result["passed"]
        total_failed += result["failed"]

        if result["failed"] > 0:
            failed_sections.append(result)
            status = f"✗ {topic}: {result['passed']}/{len(queries)} ({result['passed']*100//len(queries)}%)"
            print(status)
            for failure in result["failures"]:
                print(f"   ✗ '{failure['query']}' → {failure['got']}")
        else:
            print(f"✓ {topic}: {len(queries)}/{len(queries)} (100%)")

    total = total_passed + total_failed
    accuracy = total_passed / total * 100 if total > 0 else 0

    print("\n" + "=" * 70)
    print(f"ИТОГО: {total_passed}/{total} ({accuracy:.1f}%)")
    print(f"Секций с ошибками: {len(failed_sections)}")
    print("=" * 70)

    if failed_sections:
        print("\nСЕКЦИИ ТРЕБУЮЩИЕ ДОРАБОТКИ:\n")
        for section in sorted(failed_sections, key=lambda x: x["failed"], reverse=True):
            print(f"{section['topic']} ({section['failed']} ошибок):")
            for failure in section["failures"]:
                print(f"  - {failure['query']}")
            print()

if __name__ == "__main__":
    main()
