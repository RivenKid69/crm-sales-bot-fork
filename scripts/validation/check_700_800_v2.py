#!/usr/bin/env python3
"""
Тестирование секций 700-800 базы знаний - версия 2 с новыми запросами.
"""

import sys
sys.path.insert(0, 'src')

from knowledge.retriever import CascadeRetriever

retriever = CascadeRetriever(use_embeddings=False)

# НОВЫЕ тестовые запросы для секций 700-800 (другие формулировки)
TEST_QUERIES = {
    # 701 - товар без штрихкода
    "inventory_no_barcode_701": [
        "товары без этикеток как оформлять",
        "свежие овощи без кода продавать",
        "присвоить внутренний артикул товару",
        "весовой товар без баркода",
        "ручной ввод товара без сканирования",
    ],
    # 703 - каспи касса
    "equipment_kaspi_kassa_703": [
        "интеграция с кассой каспи банка",
        "кассовый аппарат от каспи совместим",
        "каспи pos подключить к wipon",
        "уже купил кассу в каспи",
        "каспи касса вместо вашего оборудования",
    ],
    # 704 - kaspi halyk market
    "integrations_kaspi_halyk_704": [
        "остатки синхронизируются с каспи магазином",
        "халык банк маркетплейс интеграция",
        "заказы автоматом падают в систему",
        "продаю через каспи магазин",
        "подключение к халык маркет",
    ],
    # 705 - контроль с телефона
    "mobile_phone_control_705": [
        "проверять кассу из дома",
        "уведомления о продажах на телефон",
        "мониторинг точки со смартфона",
        "дистанционно смотреть статистику",
        "контроль магазина пока в отпуске",
    ],
    # 706 - продажи сотрудников
    "analytics_employee_sales_706": [
        "рейтинг продавцов по выручке",
        "кто из кассиров лучше работает",
        "премия по результатам продаж",
        "эффективность персонала отчёт",
        "индивидуальная статистика работников",
    ],
    # 707 - одежда размеры
    "inventory_clothes_sizes_707": [
        "остатки по размерной сетке",
        "xl s m размеры в учёте",
        "группировка по цвету и размеру",
        "характеристики товаров одежда",
        "таблица размеров в карточке",
    ],
    # 708 - терминал без кассы
    "equipment_terminal_only_708": [
        "принимать карты без кассового аппарата",
        "pos терминал вместо онлайн кассы",
        "только эквайринг без фискализации",
        "почему нельзя без кассы",
        "обязательно ли покупать кассу",
    ],
    # 709 - акция Шымкент
    "promotions_shymkent_709": [
        "специальные условия для южного региона",
        "льготный тариф в шымкенте",
        "промо акция нурсат шымкент",
        "скидка новый филиал шымкент",
        "подключение со скидкой в шымкенте",
    ],
    # 710 - единицы измерения стройматериалы
    "inventory_units_construction_710": [
        "погонные метры в учёте",
        "кубометры древесины",
        "песок тоннами продавать",
        "линолеум в квадратных метрах",
        "дробные единицы измерения",
    ],
    # 711 - открыть ТОО
    "support_open_too_711": [
        "создание юридического лица",
        "регистрация тоо с нуля",
        "оформить фирму помогите",
        "документы для открытия тоо",
        "юр лицо открыть консалтинг",
    ],
    # 712 - кафе алкоголь
    "inventory_cafe_alcohol_712": [
        "бар и спиртное учёт",
        "маркировка водки вина коньяка",
        "алкогольные напитки фискализация",
        "ресторан с баром программа",
        "продажа крепкого алкоголя требования",
    ],
    # 713 - касса зависнет
    "stability_kassa_freeze_713": [
        "проблемы с оборудованием решаете",
        "техническая поддержка удалённо",
        "касса не реагирует помощь",
        "неполадки с системой что делать",
        "экстренная помощь при сбое",
    ],
    # 714 - прибыль по товару
    "analytics_profit_by_product_714": [
        "наценка по категориям отчёт",
        "рентабельность каждой позиции",
        "abc анализ товаров",
        "доходность ассортимента",
        "выгодные и невыгодные товары",
    ],
    # 715 - ЭСФ СНТ
    "fiscal_esf_snt_715": [
        "документооборот с налоговой",
        "накладные в электронном виде",
        "интеграция с порталом госуслуг",
        "сопроводительные документы онлайн",
        "автоматическая отправка в исс",
    ],
    # 716 - закрыть ИП
    "support_close_ip_716": [
        "прекратить деятельность ип",
        "ликвидация индивидуального предпринимателя",
        "снятие с учёта в налоговой",
        "заключительная отчётность при закрытии",
        "процедура закрытия бизнеса",
    ],
    # 717 - смешанная оплата
    "features_mixed_payment_717": [
        "разбить платёж на два способа",
        "частично налом частично картой",
        "комбинированная оплата в чеке",
        "два типа оплаты одновременно",
        "сплит платежа нал и безнал",
    ],
    # 718 - рынок ларёк
    "equipment_market_stall_718": [
        "касса для торговой палатки",
        "мини точка на базаре оборудование",
        "компактное решение для рынка",
        "бюджетная касса для ларька",
        "небольшой прилавок на рынке",
    ],
    # 719 - несколько складов
    "inventory_multiple_warehouses_719": [
        "учёт товаров на двух точках",
        "перенос между складами",
        "инвентаризация по складам отдельно",
        "мультисклад в одной системе",
        "распределение по филиалам",
    ],
    # 720 - косметика бренды
    "inventory_cosmetics_brands_720": [
        "учёт по производителям косметики",
        "линейки продукции в справочнике",
        "разбивка по торговым маркам",
        "парфюмерия и косметика категории",
        "серии товаров по брендам",
    ],
    # 721 - офлайн чек
    "stability_offline_check_721": [
        "пробить чек без интернета",
        "автономная работа кассы",
        "синхронизация после восстановления связи",
        "очередь чеков при отключении",
        "оффлайн режим фискализации",
    ],
    # 722 - ozon wildberries
    "integrations_ozon_wildberries_722": [
        "выход на российские площадки",
        "wb остатки синхронизация",
        "озон интеграция склада",
        "торговля в россии маркетплейсы",
        "wbay ozon подключение",
    ],
    # 723 - подключить весы
    "equipment_scales_connect_723": [
        "электронные весы к кассе",
        "автоматический ввод веса",
        "весовой товар без ручного ввода",
        "совместимые модели весов",
        "настройка связи с весами",
    ],
    # 724 - ревизия
    "inventory_revision_724": [
        "плановый пересчёт товаров",
        "сверка остатков с базой",
        "выборочная проверка позиций",
        "расхождение факт и система",
        "акт инвентаризации сформировать",
    ],
    # 725 - маркировка
    "fiscal_marked_goods_725": [
        "работа с кодами честный знак",
        "сканировать маркировку при продаже",
        "выбытие маркированного товара",
        "проверка кода маркировки",
        "отчёты по маркировке товаров",
    ],
    # 726 - единицы измерения
    "inventory_units_726": [
        "продажа на развес кг граммы",
        "товары в литрах учёт",
        "пересчёт единиц при продаже",
        "метры сантиметры в чеке",
        "разные единицы для одного товара",
    ],
    # 727 - печать ценников
    "equipment_pricetag_print_727": [
        "принтер для ценников подключить",
        "массовая печать этикеток",
        "шаблон ценника настроить",
        "обновить цены на полках",
        "ценник со штрихкодом напечатать",
    ],
    # 728 - серийные номера
    "inventory_serial_numbers_728": [
        "учёт техники по серийникам",
        "уникальный номер каждого устройства",
        "гарантийный талон по серийному",
        "поиск по серийному номеру",
        "история продаж по серийнику",
    ],
    # 729 - налоговая отчётность
    "fiscal_tax_reporting_729": [
        "формирование деклараций",
        "выгрузка для сдачи в кгд",
        "подготовка отчётов для налоговой",
        "910 форма автоматически",
        "упрощённая отчётность ип",
    ],
    # 730 - праздничные дни
    "analytics_holiday_control_730": [
        "отчёт за определённые даты",
        "фильтр по периоду продаж",
        "выручка за выходные отдельно",
        "статистика по праздникам",
        "сравнение будни и выходные",
    ],
    # 731 - маркировка лекарств
    "fiscal_medicines_marking_731": [
        "фармацевтика и маркировка",
        "коды на упаковке лекарств",
        "аптечный учёт маркировки",
        "снт на медикаменты",
        "отпуск лекарств с маркировкой",
    ],
    # 732 - без компьютера
    "mobile_phone_only_732": [
        "работа только через смартфон",
        "полноценный учёт с мобильного",
        "без десктопа управлять магазином",
        "вести бизнес с телефона",
        "смартфон заменит компьютер",
    ],
    # 733 - маржинальность
    "analytics_margin_report_733": [
        "процент наценки по товарам",
        "рентабельность продаж отчёт",
        "топ прибыльных позиций",
        "анализ маржи ассортимента",
        "какие товары больше приносят",
    ],
    # 734 - учёт расходов
    "analytics_expenses_734": [
        "учёт издержек магазина",
        "расходы на аренду коммуналку",
        "фиксация затрат в системе",
        "баланс доходов и расходов",
        "статьи затрат вести",
    ],
    # 735 - пекарня
    "products_bakery_735": [
        "хлебобулочные изделия учёт",
        "свежая выпечка остатки",
        "производство хлеба программа",
        "мини пекарня касса",
        "кондитерская и пекарня wipon",
    ],
    # 736 - киоск
    "equipment_kiosk_736": [
        "торговый павильон касса",
        "островок в тц оборудование",
        "точка в проходе какую кассу",
        "мини формат торговли",
        "компактное рабочее место кассира",
    ],
    # 737 - без штрихкодов
    "inventory_no_barcode_737": [
        "генерация штрихкодов в системе",
        "присвоить код товару самому",
        "печать своих штрихкодов",
        "артикулы вместо штрихкодов",
        "внутренняя нумерация товаров",
    ],
    # 738 - цветочный
    "inventory_flowers_738": [
        "флористика учёт букетов",
        "цветы и подарки программа",
        "композиции на заказ",
        "магазин цветов автоматизация",
        "живые цветы остатки",
    ],
    # 739 - планшет ноутбук
    "mobile_tablet_laptop_739": [
        "запуск на android планшете",
        "работа через браузер на ноуте",
        "десктоп версия для ноутбука",
        "установка на планшет",
        "веб версия на любом устройстве",
    ],
    # 740 - строительный
    "products_construction_740": [
        "магазин стройки и ремонта",
        "хозтовары и стройматериалы",
        "сантехника и плитка учёт",
        "строительная база программа",
        "инструменты и крепёж продажа",
    ],
    # 741 - накладные
    "features_print_invoices_741": [
        "выписка товарной накладной",
        "счёт на оплату из программы",
        "первичные документы формировать",
        "торг 12 распечатать",
        "оформление накладных поставщику",
    ],
    # 742 - ярмарка
    "equipment_fair_742": [
        "временная торговля на улице",
        "фестиваль выставка касса",
        "разовая торговля на мероприятии",
        "портативное решение для ярмарки",
        "оборудование для уличной торговли",
    ],
    # 743 - одежда
    "products_clothes_743": [
        "бутик одежды программа",
        "магазин fashion сегмента",
        "текстиль и аксессуары учёт",
        "шоурум одежды касса",
        "fashion ритейл автоматизация",
    ],
    # 744 - маркетплейсы
    "integrations_marketplaces_744": [
        "продажа на онлайн площадках",
        "ecommerce интеграция",
        "омниканальные продажи",
        "единый учёт онлайн и офлайн",
        "торговля через интернет платформы",
    ],
    # 745 - отключение интернета
    "stability_internet_off_745": [
        "работа при нестабильной сети",
        "отключили провайдера что будет",
        "касса без wifi работает",
        "резервный режим без интернета",
        "потеря связи не страшна",
    ],
    # 746 - excel export
    "features_excel_export_746": [
        "скачать данные в таблицу",
        "экспорт отчётов в файл",
        "выгрузка в табличном формате",
        "сохранить отчёт на компьютер",
        "конвертация в excel формат",
    ],
    # 747 - пекарня v2
    "products_bakery_747": [
        "производство и продажа выпечки",
        "кулинария и хлеб программа",
        "горячий хлеб учёт остатков",
        "мини производство и розница",
        "пироги и булочки продажа",
    ],
    # 748 - весы система
    "equipment_scales_system_748": [
        "автоматический захват веса",
        "интеграция весового оборудования",
        "передача веса в чек",
        "подключить электронные весы",
        "весы и кассовый модуль связать",
    ],
    # 749 - отчёт налоговая
    "fiscal_tax_report_749": [
        "документы для проверки налоговой",
        "выгрузка данных при проверке",
        "отчёт по требованию инспектора",
        "подготовка к налоговой проверке",
        "архив фискальных данных",
    ],
    # 750 - регистрация кассы
    "support_register_kassa_750": [
        "постановка кассы на учёт",
        "первичная настройка оборудования",
        "активация кассового аппарата",
        "начало работы с нуля помощь",
        "запуск кассы для новичка",
    ],
    # 751 - мобильный интернет
    "stability_mobile_internet_751": [
        "работа через сим карту",
        "модем 4g для кассы",
        "точка доступа со смартфона",
        "мобильная сеть вместо wifi",
        "беспроводной интернет достаточно",
    ],
    # 752 - цены букеты
    "pricing_flower_prices_752": [
        "оптовые цены для флористов",
        "прайсы для разных покупателей",
        "ценообразование в цветочном",
        "скидки постоянным клиентам цветы",
        "разная наценка опт розница",
    ],
    # 753 - iphone
    "mobile_iphone_753": [
        "скачать в app store",
        "версия для айос есть",
        "совместимость с apple устройствами",
        "установить на айпад",
        "приложение в эпл сторе",
    ],
    # 754 - акты работ
    "features_print_acts_754": [
        "документ о выполнении услуг",
        "акт приёмки сдачи работ",
        "закрывающие документы клиенту",
        "бланк акта распечатать",
        "оформление услуг документально",
    ],
    # 755 - выездная торговля
    "equipment_mobile_trade_755": [
        "торговля на дому у клиента",
        "доставка с кассой курьеру",
        "разъездная торговля оборудование",
        "мобильная точка продаж",
        "торговля на выезде какую кассу",
    ],
    # 756 - Шымкент казахский
    "regions_shymkent_promo_kz_756": [
        "шымкент акциясы қазір барма",
        "оңтүстік қазақстан жеңілдік",
        "шымкент филиалы арнайы баға",
        "жаңа кеңсе шымкент акция",
        "шымкенттегі ұсыныс туралы",
    ],
    # 757 - гарантия
    "inventory_warranty_757": [
        "гарантийное обслуживание учёт",
        "срок гарантии в карточке товара",
        "отслеживание гарантийных случаев",
        "возврат по гарантии фиксация",
        "техника с гарантией продажа",
    ],
    # 758 - СНТ ЭСФ
    "fiscal_snt_esf_758": [
        "электронный документооборот б2б",
        "сопроводительные накладные онлайн",
        "отправка эсф через программу",
        "исходящие счёт фактуры",
        "снт для оптовиков",
    ],
    # 759 - детские товары
    "inventory_kids_store_759": [
        "товары для детей магазин",
        "детское питание и игрушки",
        "одежда для малышей учёт",
        "категории по возрасту ребёнка",
        "коляски автокресла программа",
    ],
    # 760 - без бухгалтера
    "support_no_accountant_760": [
        "вести учёт самостоятельно",
        "отчётность своими силами",
        "автоматические налоговые формы",
        "без найма бухгалтера справиться",
        "простая отчётность для ип",
    ],
    # 761 - план закупок
    "inventory_purchase_plan_761": [
        "рекомендации по заказу товара",
        "минимальный остаток уведомление",
        "автоматический расчёт закупки",
        "анализ потребности в товаре",
        "система подсказок для заказа",
    ],
    # 762 - сроки годности
    "inventory_expiry_dates_762": [
        "контроль просроченной продукции",
        "учёт партий по датам",
        "уведомление об истечении срока",
        "fefo fifo для продуктов",
        "списание просрочки в системе",
    ],
    # 763 - несколько касс
    "features_multiple_kassa_763": [
        "сеть магазинов одна система",
        "синхронизация нескольких точек",
        "централизованное управление кассами",
        "много торговых точек учёт",
        "единая база для всех касс",
    ],
    # 764 - обучение
    "support_training_764": [
        "инструктаж по работе с программой",
        "видеоуроки по wipon есть",
        "обучить персонал работе",
        "консультация по настройке",
        "помощь на старте работы",
    ],
    # 765 - оптовые базы
    "products_wholesale_765": [
        "дистрибуция и оптовые продажи",
        "работа с юрлицами опт",
        "складская программа для опта",
        "b2b продажи автоматизация",
        "оптовые клиенты управление",
    ],
    # 766 - бухгалтерия
    "support_new_business_766": [
        "полное сопровождение бизнеса",
        "консалтинговые услуги wipon",
        "бухгалтерский аутсорс",
        "регистрация и ведение учёта",
        "под ключ от регистрации до отчётов",
    ],
    # 767 - умные весы казахский
    "equipment_smart_scales_kz_767": [
        "таразы бағдарламамен байланыстыру",
        "электронды таразы wipon",
        "автоматты салмақ енгізу",
        "сауда таразысы бағасы",
        "таразыны қосу нұсқаулық",
    ],
    # 768 - монитор
    "equipment_monitor_grocery_768": [
        "касса с дисплеем для продуктового",
        "pos система для минимаркета",
        "моноблок i3 i5 для магазина",
        "сенсорный экран для кассира",
        "оборудование для продуктового",
    ],
    # 769 - кассовое оборудование
    "equipment_pos_overview_769": [
        "каталог оборудования wipon",
        "комплектация рабочего места кассира",
        "линейка касс и периферии",
        "сканеры принтеры моноблоки цены",
        "выбор оборудования для магазина",
    ],
    # 770 - мобильное приложение
    "mobile_remote_app_770": [
        "скачать приложение для владельца",
        "мобильный контроль бизнеса",
        "push уведомления о продажах",
        "аналитика в кармане",
        "следить за точкой через телефон",
    ],
    # 771 - много сотрудников
    "employees_many_staff_771": [
        "лимит на количество пользователей",
        "подключить весь персонал",
        "учётные записи для сотрудников",
        "большая команда в системе",
        "масштабирование по сотрудникам",
    ],
    # 772 - удалённый доступ
    "mobile_remote_access_772": [
        "войти в систему удалённо",
        "работа из любой точки мира",
        "доступ к данным через интернет",
        "облачная система везде доступна",
        "подключение к wipon из дома",
    ],
    # 773 - умные весы
    "equipment_smart_scales_773": [
        "весы с передачей данных в кассу",
        "интеллектуальные весы wipon",
        "автовзвешивание товара",
        "весы и касса в связке",
        "подключение весов инструкция",
    ],
    # 774 - кредит
    "other_no_credit_774": [
        "рассрочка на оборудование",
        "финансирование покупки кассы",
        "взять в кредит терминал",
        "оплата частями за оборудование",
        "микрозайм на кассу",
    ],
    # 775 - что такое тис
    "tis_what_is_775": [
        "тис простым языком объясните",
        "преимущества системы тис",
        "тис для индивидуального предпринимателя",
        "зачем переходить на тис",
        "выгода от подключения тис",
    ],
    # 776 - расшифровка тис
    "tis_abbreviation_776": [
        "тис это аббревиатура чего",
        "три компонента системы тис",
        "полное название тис расшифровка",
        "тис как расшифровать",
        "аббревиатура тис означает",
    ],
    # 777 - расшифровка тис v2
    "tis_decode_777": [
        "что скрывается за названием тис",
        "тис сокращение расшифровать",
        "тис как расшифровывается полностью",
        "значение аббревиатуры тис",
        "трехкомпонентная система расшифровка",
    ],
    # 778 - консультация тис
    "tis_consultation_778": [
        "получить информацию о тис",
        "подробности про тис узнать",
        "тис консультирование по подключению",
        "разъяснение про тис нужно",
        "объясните систему тис",
    ],
    # 779 - цена тис
    "tis_price_779": [
        "стоимость подключения тис",
        "тис годовая подписка цена",
        "сколько платить за тис",
        "тарифы на тис",
        "тис цена за год два пять",
    ],
    # 780 - быстрая продажа
    "features_quick_sale_780": [
        "режим экспресс продажи",
        "быстрое обслуживание покупателей",
        "минимум кликов для чека",
        "оперативная работа на кассе",
        "ускорить процесс продажи",
    ],
    # 781 - ревизия
    "inventory_revision_explain_781": [
        "принцип работы ревизии",
        "как провести пересчёт в программе",
        "ревизия пошаговая инструкция",
        "отчёт о расхождениях формируется",
        "сверка по факту и базе",
    ],
    # 782 - приёмка
    "inventory_receiving_782": [
        "оформление прихода от поставщика",
        "накладная при приёмке товара",
        "обновление остатков при поступлении",
        "как принять товар в систему",
        "документ поступления создать",
    ],
    # 783 - wipon 5 в 1
    "equipment_5in1_783": [
        "моноблок всё в одном корпусе",
        "касса принтер сканер в одном",
        "компактное решение 5 в 1",
        "универсальный аппарат wipon",
        "всё встроено в одну кассу",
    ],
    # 784 - программа отдельно
    "pricing_program_separate_784": [
        "софт и железо вместе или отдельно",
        "программное обеспечение в комплекте",
        "нужно докупать подписку к кассе",
        "входит ли программа в стоимость",
        "покупка кассы включает софт",
    ],
    # 785 - программа отдельно v2
    "pricing_program_payment_785": [
        "абонентская плата за программу",
        "тариф нужен к оборудованию",
        "софт оплачивается ежемесячно",
        "оборудование без подписки работает",
        "стоимость программы отдельно",
    ],
    # 786 - тариф mini
    "pricing_mini_5000_786": [
        "базовый пакет wipon mini",
        "что даёт тариф за 5000",
        "функционал мини тарифа",
        "ограничения тарифа mini",
        "возможности мини подписки",
    ],
    # 787 - тариф 5000
    "pricing_5000_tariff_787": [
        "самый дешёвый тариф wipon",
        "минимальная подписка 5000 тенге",
        "стартовый тариф для начинающих",
        "эконом вариант wipon",
        "бюджетный тариф подробности",
    ],
    # 788 - mini без оборудования
    "pricing_mini_no_hardware_788": [
        "использовать mini на своём компьютере",
        "тариф 5000 без покупки кассы",
        "программа для пк без оборудования",
        "wipon mini установить на ноутбук",
        "работать без покупки железа",
    ],
    # 789 - тариф таргет
    "pricing_target_5000_789": [
        "акционный тариф из рекламы",
        "предложение из instagram 5000",
        "тариф который рекламируете",
        "специальное предложение 5000",
        "увидел рекламу wipon mini",
    ],
    # 790 - клавиатура
    "equipment_keyboard_790": [
        "работа без физической клавиатуры",
        "сенсорный ввод на моноблоке",
        "виртуальная клавиатура на экране",
        "нужно ли подключать клавиатуру",
        "ввод данных через тачскрин",
    ],
    # 791 - двухсторонний экран
    "equipment_dual_screen_side_791": [
        "какой экран для кассира какой для клиента",
        "расположение дисплеев моноблока",
        "двусторонний моноблок как устроен",
        "ориентация экранов в моноблоке",
        "кассир и покупатель видят своё",
    ],
    # 792 - ввод товаров
    "equipment_cashier_input_792": [
        "добавление позиций в чек",
        "выбор товара на экране",
        "ввод товара без сканера",
        "поиск товара при продаже",
        "добавить товар вручную в чек",
    ],
    # 793 - двойной экран модели
    "equipment_dual_screen_models_793": [
        "ассортимент касс с двумя дисплеями",
        "варианты двухэкранных моноблоков",
        "стоимость моноблоков с экраном клиента",
        "сравнение моделей с двумя экранами",
        "pos premium pos duo wipon 5в1 цены",
    ],
    # 794 - экран покупателя
    "equipment_customer_display_794": [
        "дисплей для клиента на кассе",
        "покупатель видит сумму чека",
        "второй экран для клиента цена",
        "касса с экраном покупателя модели",
        "отображение чека для клиента",
    ],
    # 795 - весы rongta
    "equipment_rongta_scales_795": [
        "подключение весов ронгта к системе",
        "rongta совместимость с wipon",
        "настройка весов ронгта",
        "весы rongta инструкция",
        "ронгта интеграция пошагово",
    ],
    # 796 - тис 2026
    "tis_2026_796": [
        "актуальность тис в следующем году",
        "изменения по тис на 2026",
        "будет ли тис работать в 2026",
        "новые лимиты тис 2026 год",
        "законодательство тис 2026",
    ],
    # 797 - онлайн касса
    "equipment_online_kassa_797": [
        "облачная касса wipon kassa",
        "кассовое решение для бизнеса",
        "онлайн фискализация wipon",
        "интернет касса для магазина",
        "современная касса с чеками онлайн",
    ],
    # 798 - быстрое подключение
    "equipment_quick_connect_798": [
        "старт работы в тот же день",
        "моментальное подключение кассы",
        "запуск за один день",
        "быстрая активация оборудования",
        "начать работу сразу после покупки",
    ],
    # 799 - функции wipon kassa
    "products_kassa_functions_799": [
        "возможности программы wipon kassa",
        "отправка чека на whatsapp",
        "возвраты и отмены в кассе",
        "аналитика продаж в wipon kassa",
        "функционал онлайн кассы wipon",
    ],
    # 800 - малый бизнес
    "products_small_business_800": [
        "решение для начинающего предпринимателя",
        "касса для небольшой точки",
        "бюджетный вариант для старта",
        "программа для микробизнеса",
        "доступное решение для маленького магазина",
    ],
}

def test_section(topic: str, queries: list) -> dict:
    """Тестирует одну секцию с несколькими запросами."""
    results = {"topic": topic, "passed": 0, "failed": 0, "failures": []}

    for query in queries:
        matches = retriever.search(query, top_k=3)
        found = False
        positions = []

        for i, match in enumerate(matches):
            match_topic = match.section.topic if match else 'unknown'
            positions.append(f"{i+1}:{match_topic[:30]}")
            if match_topic == topic:
                found = True
                break

        if found:
            results["passed"] += 1
        else:
            results["failed"] += 1
            results["failures"].append({
                "query": query,
                "got": positions
            })

    return results

def main():
    print("=" * 70)
    print("ТЕСТИРОВАНИЕ СЕКЦИЙ 700-800 (версия 2 - новые запросы)")
    print("=" * 70)

    total_passed = 0
    total_failed = 0
    failed_sections = []

    for topic, queries in TEST_QUERIES.items():
        result = test_section(topic, queries)
        total_passed += result["passed"]
        total_failed += result["failed"]

        if result["failed"] > 0:
            failed_sections.append(result)
            status = f"✗ {topic}: {result['passed']}/5 ({result['passed']*20}%)"
            print(status)
            for failure in result["failures"]:
                print(f"   ✗ '{failure['query']}' → {failure['got']}")
        else:
            print(f"✓ {topic}: 5/5 (100%)")

    total = total_passed + total_failed
    accuracy = total_passed / total * 100 if total > 0 else 0

    print("\n" + "=" * 70)
    print(f"ИТОГО: {total_passed}/{total} ({accuracy:.1f}%)")
    print(f"Секций с ошибками: {len(failed_sections)}")
    print("=" * 70)

    if failed_sections:
        print("\nСЕКЦИИ ТРЕБУЮЩИЕ ДОРАБОТКИ:\n")
        for section in sorted(failed_sections, key=lambda x: x["failed"], reverse=True):
            print(f"{section['topic']} ({section['failed']} ошибок):")
            for failure in section["failures"]:
                print(f"  - {failure['query']}")
            print()

if __name__ == "__main__":
    main()
