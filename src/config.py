"""
Конфигурация: состояния, интенты, база знаний, шаблоны
"""

# =============================================================================
# ИНТЕНТЫ И ПРИМЕРЫ
# =============================================================================

INTENT_EXAMPLES = {
    "greeting": [
        "привет", "здравствуйте", "добрый день", "хай", "приветствую"
    ],
    "price_question": [
        "сколько стоит", "какая цена", "прайс", "почём", "стоимость"
    ],
    "objection_price": [
        "дорого", "нет бюджета", "слишком дорого", "дешевле есть"
    ],
    "objection_no_time": [
        "нет времени", "занят", "не сейчас", "перезвоните позже"
    ],
    "objection_competitor": [
        "уже есть crm", "используем битрикс", "у нас амо"
    ],
    "question_features": [
        "что умеете", "какие функции", "возможности"
    ],
    "agreement": [
        "интересно", "давайте", "расскажите", "хочу попробовать", "да"
    ],
    "rejection": [
        "не интересно", "не нужно", "нет", "отстаньте"
    ],
}

# =============================================================================
# СОСТОЯНИЯ И ПЕРЕХОДЫ
# =============================================================================

SALES_STATES = {
    "greeting": {
        "goal": "Поздороваться и начать диалог",
        "required_data": [],
        "transitions": {"any": "qualification"},
        "rules": {}
    },
    
    "qualification": {
        "goal": "Узнать размер компании и боль клиента",
        "required_data": ["company_size", "pain_point"],
        "transitions": {
            "data_complete": "presentation",
            "rejection": "soft_close"
        },
        "rules": {
            "price_question": "deflect_and_continue"
        }
    },
    
    "presentation": {
        "goal": "Показать ценность продукта",
        "required_data": [],
        "transitions": {
            "agreement": "close",
            "objection_price": "handle_objection",
            "rejection": "soft_close"
        },
        "rules": {
            "price_question": "answer_with_facts"
        }
    },
    
    "handle_objection": {
        "goal": "Отработать возражение",
        "required_data": [],
        "transitions": {
            "agreement": "close",
            "rejection": "soft_close"
        },
        "rules": {}
    },
    
    "close": {
        "goal": "Взять контакт или назначить демо",
        "required_data": ["contact_info"],
        "transitions": {
            "data_complete": "success",
            "rejection": "soft_close"
        },
        "rules": {}
    },
    
    "success": {
        "goal": "Завершить успешно",
        "is_final": True
    },
    
    "soft_close": {
        "goal": "Вежливо завершить",
        "is_final": True
    }
}

# =============================================================================
# БАЗА ЗНАНИЙ
# =============================================================================

KNOWLEDGE = {
    "pricing": {
        "basic": {"name": "Базовый", "price": 990, "users": "1-5"},
        "team": {"name": "Команда", "price": 790, "users": "6-25"},
        "business": {"name": "Бизнес", "price": 590, "users": "26+"}
    },
    "features": [
        "Воронка продаж",
        "Автоматические напоминания", 
        "История клиента",
        "Отчёты"
    ],
    "discount_annual": 20
}

# =============================================================================
# ШАБЛОНЫ ПРОМПТОВ
# =============================================================================

SYSTEM_PROMPT = """Ты менеджер по продажам CRM-системы.

СТРОГО: Отвечай ТОЛЬКО на русском языке. Никогда не переключайся на другие языки.

Правила общения:
- Говори на "вы", дружелюбно, без давления
- Отвечай кратко: 2-3 предложения максимум
- Задавай только ОДИН вопрос за раз"""

PROMPT_TEMPLATES = {
    "greeting": """{system}

Задача: Поздороваться и спросить чем можете помочь.
Клиент: "{user_message}"

Ответ на русском (1-2 предложения):""",

    "qualification": """{system}

Задача: Поприветствовать клиента и начать выяснять потребности.
Клиент: "{user_message}"

Ответ на русском: поздоровайся и спроси сколько человек в команде или какая задача стоит (2-3 предложения):""",

    "deflect_and_continue": """{system}

Ситуация: Клиент спросил о цене, но мы ещё не знаем его потребности.
Задача: Мягко уйти от прямого ответа о цене, спросить о размере команды или проблеме.

Диалог:
{history}

Клиент: "{user_message}"

Ответ на русском (2-3 предложения, без приветствия):""",

    "continue_current_goal": """{system}

Цель: {goal}
Уже знаем о клиенте: {collected_data}
Нужно ещё узнать: {missing_data}

Диалог:
{history}

Клиент: "{user_message}"

Продолжи разговор, задай один вопрос чтобы узнать недостающее.
Ответ на русском (2-3 предложения, без приветствия):""",

    "presentation": """{system}

Информация о клиенте:
- Размер команды: {company_size} человек
- Проблема: {pain_point}

Наш продукт: {facts}

Задача: Кратко покажи как наш продукт решает именно ЕГО проблему.

Диалог:
{history}

Клиент: "{user_message}"

Ответ на русском (3-4 предложения, без приветствия):""",

    "handle_objection": """{system}

Ситуация: Клиент говорит что дорого.
Информация о клиенте:
- Проблема: {pain_point}
- Размер: {company_size} человек

Наш продукт: {facts}

Задача: Отработай возражение. Используй технику:
- Сравни с ценой проблемы ("сколько теряете на...")
- Или раздели на день/человека
- Упомяни скидку 20% за год

Диалог:
{history}

Клиент: "{user_message}"

Ответ на русском (2-3 предложения, без давления):""",

    "answer_with_facts": """{system}

Клиент спрашивает о продукте. Вот точные данные:
{facts}

Диалог:
{history}

Клиент: "{user_message}"

Ответь точно по фактам, на русском (2-3 предложения):""",

    "soft_close": """{system}

Ситуация: Клиент не заинтересован.
Задача: Вежливо завершить разговор, поблагодарить за время, оставить дверь открытой.

Клиент: "{user_message}"

Ответ на русском (1-2 предложения):""",

    "close": """{system}

Ситуация: Клиент заинтересован.
Задача: Предложить конкретный следующий шаг — демо или тестовый период. Попросить контакт.

Диалог:
{history}

Клиент: "{user_message}"

Ответ на русском (2-3 предложения):"""
}