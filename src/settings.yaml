# =============================================================================
# НАСТРОЙКИ CRM SALES BOT
# =============================================================================
# Этот файл содержит все настраиваемые параметры бота.
# После изменения перезапустите бота.

# -----------------------------------------------------------------------------
# LLM (Language Model)
# -----------------------------------------------------------------------------
llm:
  # Модель Ollama
  model: "qwen3:8b-fast"

  # URL сервера Ollama
  base_url: "http://localhost:11434"

  # Таймаут запроса в секундах
  timeout: 60

  # Режим стриминга (false для простоты)
  stream: false

  # Thinking mode (false для скорости)
  think: false

# -----------------------------------------------------------------------------
# RETRIEVER (Поиск по базе знаний)
# -----------------------------------------------------------------------------
retriever:
  # Использовать семантический поиск (требует sentence-transformers)
  use_embeddings: true

  # Модель для эмбеддингов
  embedder_model: "ai-forever/ru-en-RoSBERTa"

  # Пороги для каждого этапа каскада
  thresholds:
    # Exact match - точное совпадение keyword
    exact: 1.0

    # Lemma match - совпадение по леммам
    lemma: 0.15

    # Semantic match - косинусное сходство эмбеддингов
    semantic: 0.5

  # Количество результатов по умолчанию
  default_top_k: 2

# -----------------------------------------------------------------------------
# RERANKER (Переоценка результатов при низком score)
# -----------------------------------------------------------------------------
reranker:
  # Включить reranker fallback
  enabled: true

  # Модель cross-encoder (BAAI/bge-reranker-v2-m3 - мультиязычный, высокое качество)
  model: "BAAI/bge-reranker-v2-m3"

  # Порог score ниже которого включается reranker
  threshold: 0.5

  # Сколько кандидатов брать для reranking
  candidates_count: 10

# -----------------------------------------------------------------------------
# GENERATOR (Генерация ответов)
# -----------------------------------------------------------------------------
generator:
  # Количество повторных попыток при некорректном ответе LLM
  max_retries: 3

  # Количество последних сообщений в контексте
  history_length: 4

  # Количество фактов из базы знаний для контекста
  retriever_top_k: 2

  # Разрешённые английские слова (не считаются "иностранным языком")
  allowed_english_words:
    - "crm"
    - "api"
    - "ok"
    - "id"
    - "ip"
    - "sms"
    - "email"
    - "excel"
    - "whatsapp"
    - "telegram"
    - "hr"
    - "pos"
    - "erp"

# -----------------------------------------------------------------------------
# CLASSIFIER (Классификация интентов)
# -----------------------------------------------------------------------------
classifier:
  # Веса для разных методов классификации
  weights:
    root_match: 1.0       # Совпадение по корню слова
    phrase_match: 2.0     # Точное совпадение фразы
    lemma_match: 1.5      # Совпадение по лемме

  # Пороги уверенности
  thresholds:
    # Порог для быстрого возврата (высокая уверенность)
    high_confidence: 0.7

    # Минимальная уверенность (ниже = unclear)
    min_confidence: 0.3

# -----------------------------------------------------------------------------
# LOGGING (Логирование) - для будущего использования
# -----------------------------------------------------------------------------
logging:
  # Уровень логирования: DEBUG, INFO, WARNING, ERROR
  level: "INFO"

  # Логировать ли запросы к LLM
  log_llm_requests: false

  # Логировать ли результаты retriever
  log_retriever_results: false

# -----------------------------------------------------------------------------
# FEATURE FLAGS (Управление фичами)
# -----------------------------------------------------------------------------
# Позволяет постепенно включать новые возможности.
# Изменения применяются после перезапуска бота.
# Можно переопределить через переменные окружения: FF_<FLAG_NAME>=true/false

feature_flags:
  # Фаза 0: Инфраструктура (безопасно, включаем сразу)
  structured_logging: true    # JSON логи для production
  metrics_tracking: true      # Трекинг метрик диалогов

  # Фаза 1: Защита и надёжность (критично, включаем сразу)
  multi_tier_fallback: true   # 4-уровневый fallback
  conversation_guard: true    # Защита от зацикливания

  # Фаза 2: Естественность диалога
  tone_analysis: false        # Анализ тона клиента (включить после тестирования)
  response_variations: true   # Вариативность ответов (безопасно)
  personalization: false      # Персонализация на основе данных

  # Фаза 3: Оптимизация SPIN Flow
  lead_scoring: false         # Скоринг лидов (включить после калибровки)
  circular_flow: false        # Возврат назад по фазам (опасно, включать осторожно)
  objection_handler: false    # Продвинутая обработка возражений
  cta_generator: false        # Генерация Call-to-Action

# -----------------------------------------------------------------------------
# DEVELOPMENT (Режим разработки)
# -----------------------------------------------------------------------------
development:
  # Режим отладки (больше логов)
  debug: false

  # Пропускать инициализацию эмбеддингов (быстрый старт)
  skip_embeddings: false
