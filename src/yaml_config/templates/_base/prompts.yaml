# =============================================================================
# BASE PROMPT TEMPLATES
# =============================================================================
# Версия: 1.0
# Базовые шаблоны промптов для всех flows.
# Используют Jinja2-подобные переменные: {variable}
#
# Каждый шаблон содержит:
#   template: str - текст промпта с placeholders
#   description: str - описание для документации
#   parameters: list - обязательные и опциональные параметры
# =============================================================================

templates:
  # =================================================================
  # ПРИВЕТСТВИЕ
  # =================================================================

  greet_back:
    description: "Ответить на приветствие"
    parameters:
      required: [system, user_message]
    template: |
      {system}

      Задача: Просто поздороваться в ответ и спросить чем можете помочь.
      НЕ задавай вопросов о компании или команде — просто узнай что интересует клиента.

      Клиент: "{user_message}"

      Ответ на русском (1-2 коротких предложения):

  ask_how_to_help:
    description: "Спросить чем можно помочь"
    parameters:
      required: [system, history, user_message]
    template: |
      {system}

      Задача: Вежливо спросить чем можете помочь.
      НЕ задавай конкретных вопросов — просто узнай что интересует клиента.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Ответ на русском (1-2 коротких предложения):

  greeting:
    description: "Начальное приветствие"
    parameters:
      required: [system, user_message]
    template: |
      {system}

      Задача: Поздороваться и спросить чем можете помочь.
      Клиент: "{user_message}"

      Ответ на русском (1-2 предложения):

  # =================================================================
  # ОБРАБОТКА ЦЕН
  # =================================================================

  deflect_and_continue:
    description: "Отвлечь от цены, уточнить размер команды"
    parameters:
      required: [system, history, user_message]
    template: |
      {system}

      Ситуация: Клиент спросил о цене, но мы не знаем размер его команды.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Структура ответа:
      1. Признай вопрос о цене (покажи что услышал)
      2. Объясни что цена зависит от количества пользователей
      3. Спроси сколько человек будет работать

      Пример: "Хороший вопрос! Стоимость зависит от размера команды. Подскажите, сколько человек будет пользоваться системой?"

      Задай ОДИН вопрос. Ответ на русском (2 предложения):

  answer_with_facts:
    description: "Ответить по фактам"
    addresses_question: true
    parameters:
      required: [system, facts, history, user_message]
      optional: [goal]
    template: |
      {system}

      Клиент спрашивает о продукте. Вот точные данные:
      {facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Ответь точно по фактам (2-3 предложения).
      Цель текущего этапа: {goal}
      После ответа мягко задай ОДИН вопрос, продвигающий к цели этапа.

      Ответ на русском:

  answer_with_range_and_qualify:
    description: "Ответить диапазоном цен и уточнить"
    addresses_question: true
    parameters:
      required: [system, facts, history, user_message]
    template: |
      {system}

      Клиент спросил о цене. Сначала дай диапазон, потом уточни.

      Факты о ценах: {facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Ответь по структуре:
      1. Диапазон цен (от X до Y за человека)
      2. Упомяни что зависит от размера команды
      3. Спроси сколько человек будет работать

      Пример: "От 590 до 990₽ за человека в месяц — зависит от размера команды. Подскажите, сколько человек будет пользоваться?"

      Ответ на русском (2 предложения, до 40 слов):

  # НОВОЕ: Ответить на вопрос о цене (ОБЯЗАТЕЛЬНО с ценой)
  answer_with_pricing:
    description: "Ответить на вопрос о цене - ОБЯЗАТЕЛЬНО с ценой"
    addresses_question: true
    parameters:
      required: [system, facts, retrieved_facts, history, user_message, company_size]
      optional: [do_not_ask, collected_fields_list]
    template: |
      === ЦЕНЫ WIPON (ИСПОЛЬЗУЙ ЭТИ ДАННЫЕ В ОТВЕТЕ!) ===
      {facts}
      =====================================================

      {system}

      ⚠️ КРИТИЧЕСКИ ВАЖНО: Клиент спросил о цене.
      ПЕРВЫМ ДЕЛОМ назови конкретные цифры из блока ЦЕНЫ выше.
      Только ПОСЛЕ цены можно задать уточняющий вопрос.

      ПРАВИЛЬНО: "Стоимость от 590 до 990₽ за человека в месяц. Подскажите, сколько сотрудников?"
      НЕПРАВИЛЬНО: "Сколько сотрудников?" (БЕЗ цены — ЗАПРЕЩЕНО!)
      НЕПРАВИЛЬНО: "Цена зависит от многих факторов" (ЗАПРЕЩЕНО!)

      === ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ ===
      {retrieved_facts}
      ==========================

      Размер команды клиента: {company_size}

      {do_not_ask}

      Уже известно о клиенте: {collected_fields_list}

      Диалог:
      {history}

      Клиент спросил: "{user_message}"

      {do_not_ask}

      Твоя задача (СТРОГО В ТАКОМ ПОРЯДКЕ):
      1. СНАЧАЛА ответь на вопрос о цене конкретно:
         - Если известен размер команды ({company_size}) — дай конкретный тариф
         - Если размер НЕ известен — дай диапазон "от X до Y₽ за человека"
      2. ПОТОМ (и только потом!) можешь задать ОДИН уточняющий вопрос (если НЕ запрещено выше)

      ВАЖНО: Если размер команды уже указан ({company_size} ≠ "не указан"), НЕ спрашивай "сколько сотрудников" — назови конкретный тариф.

      Примеры ПРАВИЛЬНЫХ ответов:
      - "Для команды из 5 человек подойдёт тариф Lite — 790₽ за человека в месяц. Хотите узнать что входит?"
      - "Стоимость от 590 до 990₽ за человека в месяц, зависит от размера команды. Сколько человек будет работать?"
      - "При оплате за год — от 490₽/человек. Подскажите, какие задачи хотите решить?"

      Примеры НЕПРАВИЛЬНЫХ ответов (НЕ ДЕЛАЙ ТАК!):
      - "Расскажите сначала о вашей компании..." ← НЕТ! Сначала цена!
      - "Цена зависит от многих факторов..." ← НЕТ! Дай конкретику!
      - "А сколько человек в команде?" ← НЕТ без цены! Сначала диапазон!

      Ответ на русском (2-3 предложения, ОБЯЗАТЕЛЬНО с ценой):

  answer_with_pricing_direct:
    description: "Ответить ТОЛЬКО ценой, без дополнительных вопросов (frustrated/rushed)"
    addresses_question: true
    parameters:
      required: [system, facts, retrieved_facts, history, user_message, company_size]
      optional: [collected_fields_list]
    template: |
      === ЦЕНЫ WIPON ===
      {facts}
      ==================

      {system}

      КРИТИЧЕСКИ ВАЖНО: Клиент раздражён/торопится. Ему нужна ТОЛЬКО цена.
      НЕ задавай НИКАКИХ вопросов. ТОЛЬКО конкретные цифры.

      === ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ ===
      {retrieved_facts}
      ==========================

      Размер команды клиента: {company_size}
      Уже известно: {collected_fields_list}

      Диалог:
      {history}

      Клиент спросил: "{user_message}"

      Правила:
      1. Назови конкретную цену или диапазон
      2. НЕ задавай вопросов — НИКАКИХ
      3. Максимум 1-2 предложения

      Примеры:
      - "Тарифы от 590 до 990 тенге за человека в месяц. При оплате за год — скидка 20%."
      - "Для команды из {company_size} человек подойдёт тариф Lite — 790 тенге/человек."

      Ответ на русском (1-2 предложения, ТОЛЬКО цена):

  answer_pricing_details:
    description: "Ответить на вопрос о деталях тарифов"
    addresses_question: true
    parameters:
      required: [system, retrieved_facts, history, user_message]
    template: |
      {system}

      Клиент хочет узнать детали тарифов. Ответь КОНКРЕТНО.

      === ИНФОРМАЦИЯ О ТАРИФАХ ===
      {retrieved_facts}
      ============================

      Диалог:
      {history}

      Клиент спросил: "{user_message}"

      Твоя задача:
      1. Объясни структуру тарифов (что входит, чем отличаются)
      2. Используй конкретные цифры из фактов выше
      3. Если уместно — порекомендуй оптимальный тариф

      Ответ на русском (2-4 предложения, структурированно):

  # =================================================================
  # ПРОДОЛЖЕНИЕ РАЗГОВОРА
  # =================================================================

  continue_current_goal:
    description: "Продолжить к текущей цели"
    parameters:
      required: [system, goal, collected_data, missing_data, history, user_message]
      optional: [do_not_ask, available_questions]
    template: |
      {system}

      Цель этапа: {goal}
      Уже знаем о клиенте: {collected_data}
      Нужно узнать: {missing_data}
      {do_not_ask}

      Диалог:
      {history}

      Клиент: "{user_message}"

      ВАЖНО - структура ответа:
      1. СНАЧАЛА кратко отреагируй на слова клиента (признай проблему, вырази понимание)
      2. ПОТОМ естественно перейди к вопросу, который продвигает цель этапа ({goal})

      Примеры хороших переходов (чередуй вступления, НЕ используй "Понимаю"):
      - "Низкие продажи — серьёзный вызов. Подскажите, какую задачу хотите решить в первую очередь?"
      - "Да, потеря клиентов — частая боль. А какой CRM пользовались раньше?"
      - "Это важный момент. Скажите, сколько человек в вашей команде продаж?"
      - "[Сразу к делу] Что именно хотите автоматизировать?"

      Если нужно узнать company_size — спроси сколько человек в команде/продажах.
      Если нужно узнать pain_point — спроси какую задачу хотят решить или что не устраивает сейчас.
      Если нужно узнать contact_info — попроси номер телефона или email для связи.

      Задай только ОДИН вопрос. Не начинай с "Отлично!" или "Спасибо!".
      Ответ на русском (2 предложения: реакция + вопрос):

  # =================================================================
  # ВОПРОСЫ И ОТВЕТЫ
  # =================================================================

  answer_question:
    description: "Ответить на вопрос клиента"
    addresses_question: true
    parameters:
      required: [system, retrieved_facts, history, user_message]
    template: |
      {system}

      ВАЖНО: Клиент задал вопрос — ты ОБЯЗАН на него ответить!
      Используй ТОЛЬКО факты ниже. Если информации нет — честно скажи что уточнишь.

      === ФАКТЫ О ПРОДУКТЕ ===
      {retrieved_facts}
      ========================

      Диалог:
      {history}

      Клиент спросил: "{user_message}"

      Твоя задача:
      1. СНАЧАЛА кратко ответь на вопрос клиента (2-3 предложения)
      2. ПОТОМ задай ОДИН уточняющий вопрос чтобы лучше понять потребности
         (например: сколько человек в команде, какие задачи хотите решить)

      НЕ игнорируй вопрос клиента! Сначала ответ, потом вопрос.
      Ответ на русском:

  answer_with_knowledge:
    description: "Ответить используя базу знаний"
    addresses_question: true
    parameters:
      required: [system, retrieved_facts, company_size, pain_point, history, user_message]
    template: |
      {system}

      ВАЖНО: Отвечай СТРОГО на основе фактов ниже.
      Если информации нет в фактах — скажи "Уточню у коллег и сразу вернусь с ответом".
      НЕ ПРИДУМЫВАЙ информацию, которой нет.

      === ФАКТЫ О ПРОДУКТЕ ===
      {retrieved_facts}
      ========================

      Информация о клиенте:
      - Размер: {company_size}
      - Потребность: {pain_point}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Ответь кратко (2-3 предложения), используя ТОЛЬКО факты выше.
      Ответ на русском:

  answer_and_continue:
    description: "Ответить и продолжить разговор"
    addresses_question: true
    parameters:
      required: [system, history, user_message, spin_phase, collected_data, facts]
      optional: [goal]
    template: |
      {system}

      СИТУАЦИЯ: Клиент задал вопрос. Нужно ответить и продолжить диалог.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Текущая фаза: {spin_phase}
      Уже знаем: {collected_data}

      Факты для ответа (если есть): {facts}

      Цель текущего этапа: {goal}

      Твоя задача:
      1. Кратко и по делу ответь на вопрос клиента
      2. Плавно верни разговор к цели этапа ({goal})

      Ответ на русском (2-3 предложения):

  # =================================================================
  # ФИНАЛЬНЫЕ СОСТОЯНИЯ
  # =================================================================

  presentation:
    description: "Презентация продукта"
    parameters:
      required: [system, company_size, pain_point, facts, history, user_message]
    template: |
      {system}

      Информация о клиенте:
      - Размер команды: {company_size} человек
      - Проблема: {pain_point}

      Наш продукт: {facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Структура ответа:
      1. Кратко отреагируй на последнее сообщение клиента (покажи что услышал)
      2. Покажи как наш продукт решает именно ЕГО проблему ({pain_point})
      3. Спроси готов ли попробовать или есть вопросы

      Пример: "Да, с командой из {company_size} человек это особенно актуально. Наша CRM поможет [решение проблемы]. Хотите посмотреть как это работает?"

      Ответ на русском (3-4 предложения):

  soft_close:
    description: "Мягкое закрытие"
    parameters:
      required: [system, history, user_message]
    template: |
      {system}

      Ситуация: Клиент не заинтересован или отказывается.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Структура ответа:
      1. Признай решение клиента (без давления, с уважением)
      2. Поблагодари за время
      3. Оставь дверь открытой (если передумает — всегда рады помочь)

      Пример: "Ясно, сейчас не время. Спасибо что уделили время! Если вопрос станет актуальным — обращайтесь, буду рад помочь."

      Ответ на русском (2 предложения, тепло и без обиды):

  close:
    description: "Закрытие сделки"
    parameters:
      required: [system, history, user_message]
      optional: [do_not_ask]
    template: |
      {system}

      Ситуация: Клиент заинтересован и готов к следующему шагу.

      Диалог:
      {history}

      Клиент: "{user_message}"

      {do_not_ask}

      Структура ответа:
      1. Позитивно отреагируй на интерес клиента
      2. Предложи конкретный следующий шаг (демо или тестовый период)
      3. Если контакт ещё не получен — попроси контакт для связи

      Пример: "Отлично, рад что заинтересовались! Давайте запишу вас на демо — покажу систему под ваши задачи. Подскажите удобный номер или почту для связи?"

      Ответ на русском (2-3 предложения):

  # =================================================================
  # ВОЗРАЖЕНИЯ
  # =================================================================

  handle_objection:
    description: "Обработка возражения о цене"
    addresses_question: true
    parameters:
      required: [system, pain_point, company_size, facts, history, user_message]
    template: |
      {system}

      Ситуация: Клиент говорит что дорого.
      Информация о клиенте:
      - Проблема: {pain_point}
      - Размер: {company_size} человек

      Наш продукт: {facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Структура ответа:
      1. СНАЧАЛА признай опасения клиента (покажи что понимаешь)
      2. ПОТОМ мягко отработай возражение одной из техник:
         - Сравни с ценой проблемы ("сколько теряете на {pain_point}...")
         - Или раздели на день/человека
         - Упомяни скидку 20% за год

      Пример: "Да, вопрос бюджета важен. При этом, если сейчас теряете хотя бы одного клиента в месяц — это уже дороже подписки. А при оплате за год ещё скидка 20%."

      Ответ на русском (2-3 предложения, без давления, с эмпатией):

  handle_objection_no_time:
    description: "Обработка возражения 'нет времени'"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент говорит что у него нет времени.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Проявить понимание
      2. Предложить альтернативу (связаться позже, отправить информацию)
      3. НЕ давить

      Пример: "Да, время дорого. Могу написать вам позже или скинуть краткую информацию на почту — как удобнее?"

      Ответ на русском (2 предложения):

  handle_objection_think:
    description: "Обработка возражения 'надо подумать'"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент говорит что ему нужно подумать/посоветоваться.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Поддержать решение
      2. Предложить дополнительную информацию или ответить на вопросы
      3. Договориться о следующем шаге

      Пример: "Конечно, важное решение не принимают на ходу. Могу отправить презентацию — будет проще обсудить с коллегами. Куда удобнее — на почту или в мессенджер?"

      Ответ на русском (2-3 предложения):

  # =================================================================
  # СОЦИАЛЬНЫЕ ИНТЕНТЫ
  # =================================================================

  small_talk_and_continue:
    description: "Ответить на small talk и продолжить"
    parameters:
      required: [system, history, user_message, spin_phase, collected_data]
      optional: [goal]
    template: |
      {system}

      СИТУАЦИЯ: Клиент отклонился от темы (small talk).
      Нужно вежливо ответить и мягко вернуться к делу.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Текущая фаза: {spin_phase}
      Уже знаем: {collected_data}

      Цель текущего этапа: {goal}

      Твоя задача:
      1. Кратко и дружелюбно ответь на реплику клиента (1 предложение)
      2. Плавно верни разговор к цели этапа ({goal})

      Пример: "Спасибо, всё хорошо! Так вот, возвращаясь к вашей ситуации..."

      Ответ на русском (2 короткие предложения):

  acknowledge_and_continue:
    description: "Принять благодарность и продолжить"
    parameters:
      required: [system, history, user_message, spin_phase, collected_data]
      optional: [goal]
    template: |
      {system}

      СИТУАЦИЯ: Клиент выразил благодарность в середине разговора.
      Нужно принять благодарность и продолжить диалог.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Текущая фаза: {spin_phase}
      Уже знаем: {collected_data}

      Цель текущего этапа: {goal}

      Твоя задача:
      1. Кратко и тепло ответить на благодарность
      2. Продолжить разговор к цели этапа ({goal})

      Пример: "Пожалуйста! Рад помочь. Так вот, продолжая наш разговор..."

      Ответ на русском (2 короткие предложения):

  handle_farewell:
    description: "Обработка прощания"
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент прощается. Нужно вежливо завершить разговор.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Попрощаться тепло и дружелюбно
      2. Если контакт не собран — мягко предложить связаться позже

      Пример: "До свидания! Если появятся вопросы — обращайтесь."

      Ответ на русском (1-2 предложения):

  # =================================================================
  # УТИЛИТЫ
  # =================================================================

  clarify_and_continue:
    description: "Уточнить и продолжить"
    parameters:
      required: [system, history, user_message, spin_phase, collected_data]
      optional: [goal]
    template: |
      {system}

      СИТУАЦИЯ: Ответ клиента неясен. Нужно мягко уточнить.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Текущая фаза: {spin_phase}
      Уже знаем: {collected_data}

      Цель текущего этапа: {goal}

      Твоя задача:
      1. Покажи что услышал клиента
      2. Уточни что имел в виду, направляя к цели этапа ({goal})

      Пример: "Интересно! Можете рассказать подробнее?"

      Ответ на русском (1-2 предложения):

  clarify_one_question:
    description: "Задать один уточняющий вопрос"
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент дал неясный ответ. Нужно мягко переспросить.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Покажи что понял (не критикуй)
      2. Переформулируй вопрос более конкретно
      3. Предложи варианты если уместно

      Ответ на русском (2 предложения):

  summarize_and_clarify:
    description: "Резюмировать и уточнить"
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент дал противоречивую информацию.
      Нужно резюмировать что поняли и уточнить.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Кратко резюмируй что поняли
      2. Уточни конкретный момент

      Пример: "Так, если я правильно понял: у вас команда из X человек и есть сложности с Y. Верно?"

      Ответ на русском (2 предложения):

  nudge_progress:
    description: "Ответить кратко и вернуть к основному вопросу"
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент задаёт побочные вопросы и не продвигается по основной теме разговора.
      Нужно кратко ответить на текущий вопрос и мягко вернуть к основному вопросу квалификации.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Кратко ответь на текущий вопрос клиента (1 предложение)
      2. Мягко верни разговор к основному вопросу квалификации

      Пример: "Да, интеграция с 1С есть. А скажите, какой у вас основной запрос к системе автоматизации?"

      Ответ на русском (2 предложения):

  answer_with_summary:
    description: "Ответить на повторный вопрос с фактами и резюме"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data]
      optional: [retrieved_facts, goal]
    template: |
      {system}

      СИТУАЦИЯ: Клиент повторяет вопрос — значит предыдущий ответ был недостаточным.
      Нужно ответить конкретнее, используя факты.

      === ФАКТЫ ===
      {retrieved_facts}
      =============

      Что мы уже обсудили: {collected_data}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Цель текущего этапа: {goal}

      Твоя задача:
      1. Кратко признай что уже обсуждали это (1 фраза, без извинений)
      2. Дай КОНКРЕТНЫЙ ответ с цифрами/фактами из секции ФАКТЫ
      3. Если фактов нет — честно скажи что уточнишь и вернёшься
      4. ТОЛЬКО если ты полностью ответил на вопрос клиента — можешь задать
         ОДИН вопрос по цели этапа. Если клиент спрашивал конкретное (цена,
         функции, интеграции) — НЕ задавай вопрос, пока не дашь полный ответ.

      Ответ на русском (2-3 предложения, ОБЯЗАТЕЛЬНО включи конкретный ответ):

  close_answer_and_collect:
    description: "Ответить на вопрос и попросить контакт"
    parameters:
      required: [system, history, user_message, collected_data, facts]
      optional: [retrieved_facts, goal]
    template: |
      {system}

      СИТУАЦИЯ: Клиент задал вопрос на этапе закрытия сделки.
      Нужно ответить И попросить контакт для продолжения.

      Факты для ответа: {facts}
      {retrieved_facts}

      Диалог:
      {history}

      Клиент: "{user_message}"
      Уже знаем: {collected_data}

      Твоя задача:
      1. Кратко ответь на вопрос клиента (1-2 предложения)
      2. Плавно перейди к получению контакта

      Примеры:
      - "[ответ на вопрос]. Чтобы подготовить детальное сравнение — на какой email отправить?"
      - "[ответ на вопрос]. Давайте обсудим подробнее — оставьте номер, я свяжусь."

      Ответ на русском (2-3 предложения: ответ + просьба контакта):

  confirm_and_collect_contact:
    description: "Подтвердить и собрать контакт"
    parameters:
      required: [system, history, user_message, collected_data]
      optional: [do_not_ask]
    template: |
      {system}

      СИТУАЦИЯ: Клиент выразил интерес к демо/звонку/консультации.
      Нужно подтвердить и собрать контактные данные.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      {do_not_ask}

      Твоя задача:
      1. Подтверди что всё понял
      2. Если контакт ещё НЕ получен — попроси контактные данные (телефон или email) для связи

      Пример: "Отлично, договорились! Подскажите номер телефона — перезвоним в удобное время."

      Ответ на русском (2 предложения):

  # =================================================================
  # ТОНАЛЬНОСТЬ (Phase 2)
  # =================================================================

  short_response_frustrated:
    description: "Короткий ответ для раздражённого клиента"
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      ВАЖНО: Клиент раздражён. Будь МАКСИМАЛЬНО кратким.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Признай неудобство (одна фраза)
      2. Ответь по существу максимально коротко
      3. НЕ задавай лишних вопросов

      Максимум 1-2 предложения, до 25 слов.

      Ответ на русском:

  empathetic_response:
    description: "Эмпатичный ответ на проблему"
    parameters:
      required: [system, history, user_message, pain_point, collected_data]
    template: |
      {system}

      КОНТЕКСТ: Клиент озвучил проблему. Покажи что понимаешь.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Проблема клиента: {pain_point}
      Уже знаем: {collected_data}

      Твоя задача:
      1. Признай проблему с эмпатией (НЕ шаблонно!)
      2. Задай один уточняющий вопрос о последствиях

      Примеры эмпатичных реакций (чередуй, НЕ начинай со слова "Понимаю"):
      - "Да, знакомая ситуация..."
      - "Это реально отнимает силы..."
      - "Многие с этим сталкиваются..."

      НЕ используй: "Отлично!", "Спасибо за информацию!", "Понимаю вас!", "Понимаю,"

      Ответ на русском (2 предложения):

  informal_response:
    description: "Неформальный ответ"
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      КОНТЕКСТ: Клиент общается неформально. Подстройся под его стиль.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Ответь в том же неформальном стиле
      2. Используй "ты" вместо "вы" если клиент сам на "ты"
      3. Можно использовать разговорные выражения

      Примеры:
      - "Короче, тут такая тема..."
      - "Ну смотри, по ценам..."
      - "Понял, окей..."

      НЕ перегибай с неформальностью. Будь естественным.

      Ответ на русском (2-3 предложения):

  soft_exit_frustrated:
    description: "Мягкий выход для раздражённого клиента"
    parameters:
      required: [system, history, user_message]
    template: |
      {system}

      СИТУАЦИЯ: Клиент очень раздражён. Нужно завершить без давления.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Твоя задача:
      1. Кратко извинись
      2. Предложи альтернативу (информация на почту / связаться позже)
      3. НЕ навязывайся

      Пример: "Хорошо, не буду отнимать время. Если будет интересно — пишите, с удовольствием помогу."

      Максимум 2 предложения.

      Ответ на русском:

  # =================================================================
  # GO BACK HANDLING
  # =================================================================

  acknowledge_go_back:
    description: "Подтвердить возврат к предыдущему этапу"
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент хочет вернуться к предыдущему этапу разговора.
      Это нормально — возможно он хочет что-то уточнить или изменить.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Подтверди что понял — клиент хочет вернуться
      2. Спроси что именно хочет уточнить или изменить

      Пример: "Конечно, давайте вернёмся. Что именно хотели бы уточнить?"

      Ответ на русском (1-2 предложения):

  go_back_limit_reached:
    description: "Объяснить что лимит возвратов достигнут"
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент уже несколько раз возвращался назад в разговоре.
      Больше возвратов делать не стоит — это может привести к зацикливанию.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Мягко объясни что лучше продолжить с текущего момента
      2. Предложи помощь с тем вопросом, который клиент хочет решить
      3. НЕ говори про "лимиты" или "ограничения" — это звучит робоtично

      Пример: "Давайте лучше разберёмся с вашим вопросом прямо сейчас. Что именно вас беспокоит?"

      Ответ на русском (2 предложения):

  # =================================================================
  # OBJECTION HANDLING (Step 3A — addresses_question: true)
  # =================================================================

  reframe_value:
    description: "Переформулировать ценность при повторных возражениях"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data, facts, pain_point]
    template: |
      {system}

      СИТУАЦИЯ: Клиент повторно возражает. Нужно переформулировать ценность с нового угла.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      Факты о продукте: {facts}
      Боль клиента: {pain_point}

      Твоя задача:
      1. Покажи, что слышишь клиента
      2. Переформулируй ценность с НОВОГО угла (не повторяй предыдущие аргументы)
      3. Свяжи ценность с конкретной болью клиента

      Ответ на русском (2-3 предложения):

  handle_repeated_objection:
    description: "Обработать многократное возражение — предложить пробный период/демо/референс"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data, facts, pain_point]
    template: |
      {system}

      СИТУАЦИЯ: Клиент возражает 3+ раза. Стандартные аргументы не работают.
      Нужно предложить конкретный следующий шаг.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      Факты о продукте: {facts}
      Боль клиента: {pain_point}

      Твоя задача:
      1. Признать позицию клиента без спора
      2. Предложить один конкретный шаг: пробный период, демо, или кейс похожего клиента
      3. Дать клиенту выбор без давления

      Ответ на русском (2-3 предложения):

  empathize_and_redirect:
    description: "Эмпатия при эмоциональном возражении + перенаправление"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data, facts, pain_point]
    template: |
      {system}

      СИТУАЦИЯ: Клиент эмоционально фрустрирован. Нужно проявить эмпатию и мягко вернуть к ранее проявленному интересу.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      Факты о продукте: {facts}
      Боль клиента: {pain_point}

      Твоя задача:
      1. Проявить искреннюю эмпатию (НЕ шаблонные фразы)
      2. Мягко напомнить о ранее высказанном интересе
      3. Предложить минимальный следующий шаг

      Ответ на русском (2-3 предложения):

  # =================================================================
  # SCHEDULING / PURCHASE (Step 3B — addresses_question: true)
  # =================================================================

  schedule_demo:
    description: "Подтвердить запрос на демо и собрать контакт"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data]
      optional: [do_not_ask, retrieved_facts]
    template: |
      {system}

      СИТУАЦИЯ: Клиент запросил демонстрацию. Нужно подтвердить и собрать контактные данные.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      {do_not_ask}

      Твоя задача:
      1. Подтверди готовность показать демо
      2. Спроси удобное время и контакт для связи (если ещё не знаем)

      Ответ на русском (2 предложения):

  schedule_callback:
    description: "Подтвердить запрос на колбек и собрать время/контакт"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data]
      optional: [do_not_ask, retrieved_facts]
    template: |
      {system}

      СИТУАЦИЯ: Клиент хочет, чтобы ему перезвонили. Нужно уточнить время и контакт.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      {do_not_ask}

      Твоя задача:
      1. Подтверди, что перезвоним
      2. Уточни удобное время и контактный телефон (если ещё не знаем)

      Ответ на русском (2 предложения):

  provide_references:
    description: "Предоставить кейсы/рекомендации и предложить отправить на email"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data]
      optional: [do_not_ask, retrieved_facts]
    template: |
      {system}

      СИТУАЦИЯ: Клиент хочет увидеть кейсы или рекомендации от других клиентов.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      {do_not_ask}

      Твоя задача:
      1. Подтверди наличие успешных кейсов
      2. Предложи отправить подборку на email (если контакт ещё не знаем — попроси)

      Ответ на русском (2 предложения):

  schedule_consultation:
    description: "Подтвердить запрос на консультацию и собрать контакт"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data]
      optional: [do_not_ask, retrieved_facts]
    template: |
      {system}

      СИТУАЦИЯ: Клиент хочет консультацию. Нужно подтвердить и собрать контакт.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      {do_not_ask}

      Твоя задача:
      1. Подтверди готовность провести консультацию
      2. Уточни удобное время и контакт (если ещё не знаем)

      Ответ на русском (2 предложения):

  # =================================================================
  # COMPETITOR COMPARISON (Step 3C — addresses_question: true)
  # =================================================================

  compare_with_competitor:
    description: "Сравнить продукт с конкурентом"
    addresses_question: true
    parameters:
      required: [system, retrieved_facts, history, user_message, facts]
    template: |
      {system}

      СИТУАЦИЯ: Клиент спрашивает о сравнении с конкурентом или упоминает конкурента.

      База знаний:
      {retrieved_facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Факты о продукте: {facts}

      Твоя задача:
      1. Корректно и уважительно отметь разницу
      2. Подчеркни уникальные преимущества нашего решения
      3. НЕ критикуй конкурента напрямую

      Ответ на русском (2-3 предложения):

  # =================================================================
  # PRICING / ROI (Step 3D — addresses_question: true)
  # =================================================================

  answer_with_roi:
    description: "Ответить на вопрос с ROI-фреймингом"
    addresses_question: true
    parameters:
      required: [system, facts, retrieved_facts, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент спрашивает про ROI, окупаемость или экономический эффект.

      Факты о продукте: {facts}
      База знаний: {retrieved_facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Ответить о ROI/окупаемости с конкретными цифрами если возможно
      2. Связать с данными клиента (размер, боль)
      3. Предложить расчёт под их вводные

      Ответ на русском (2-3 предложения):

  # =================================================================
  # FACT QUESTION INTENT-SPECIFIC (Step 3E — addresses_question: true)
  # =================================================================

  answer_technical_question:
    description: "Ответить на технический вопрос"
    addresses_question: true
    parameters:
      required: [system, retrieved_facts, history, user_message, collected_data, facts]
    template: |
      {system}

      СИТУАЦИЯ: Клиент задаёт технический вопрос (API, интеграции, архитектура).

      База знаний:
      {retrieved_facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      Факты о продукте: {facts}

      Твоя задача:
      1. Дать точный технический ответ на основе базы знаний
      2. Если деталей нет — предложить связаться с техкомандой

      Ответ на русском (2-3 предложения):

  answer_security_question:
    description: "Ответить на вопрос о безопасности"
    addresses_question: true
    parameters:
      required: [system, retrieved_facts, history, user_message, collected_data, facts]
    template: |
      {system}

      СИТУАЦИЯ: Клиент спрашивает о безопасности, защите данных, compliance.

      База знаний:
      {retrieved_facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      Факты о продукте: {facts}

      Твоя задача:
      1. Ответить о мерах безопасности и compliance на основе базы знаний
      2. Упомянуть ключевые сертификации/стандарты если есть

      Ответ на русском (2-3 предложения):

  explain_support_options:
    description: "Рассказать о вариантах поддержки"
    addresses_question: true
    parameters:
      required: [system, retrieved_facts, history, user_message, collected_data, facts]
    template: |
      {system}

      СИТУАЦИЯ: Клиент спрашивает о поддержке, SLA, сервисных пакетах.

      База знаний:
      {retrieved_facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      Факты о продукте: {facts}

      Твоя задача:
      1. Рассказать о доступных вариантах поддержки из базы знаний
      2. Упомянуть SLA и время реакции если известно

      Ответ на русском (2-3 предложения):

  explain_training_options:
    description: "Рассказать об обучении и онбординге"
    addresses_question: true
    parameters:
      required: [system, retrieved_facts, history, user_message, collected_data, facts]
    template: |
      {system}

      СИТУАЦИЯ: Клиент спрашивает про обучение, онбординг, тренинги для команды.

      База знаний:
      {retrieved_facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      Факты о продукте: {facts}

      Твоя задача:
      1. Описать процесс обучения и онбординга из базы знаний
      2. Упомянуть доступные материалы и формат

      Ответ на русском (2-3 предложения):

  explain_implementation_process:
    description: "Рассказать о процессе внедрения"
    addresses_question: true
    parameters:
      required: [system, retrieved_facts, history, user_message, collected_data, facts]
    template: |
      {system}

      СИТУАЦИЯ: Клиент спрашивает про процесс внедрения, сроки, этапы.

      База знаний:
      {retrieved_facts}

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}
      Факты о продукте: {facts}

      Твоя задача:
      1. Описать этапы внедрения из базы знаний
      2. Дать ориентир по срокам

      Ответ на русском (2-3 предложения):

  # =================================================================
  # CROSS-FLOW TEMPLATES (Step 5 — moved from flow-specific to _base)
  # =================================================================

  calculate_roi_response:
    description: "Ответ с прикидкой ROI (универсальный)"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент спрашивает про эффект/ROI.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Коротко объяснить, что ROI зависит от вводных
      2. Попросить один ключевой вводный показатель

      Пример: "ROI зависит от объёма и текущих затрат. Сколько времени в среднем тратит менеджер на обработку одной заявки?"

      Ответ на русском (2 предложения):

  share_value:
    description: "Поделиться ценностью (универсальный)"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент интересуется функционалом. Нужно показать ценность.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Коротко обозначить ценность
      2. Задать вопрос о релевантности

      Пример: "Это помогает снизить потери и ускорить обработку. Вам это актуально?"

      Ответ на русском (2 предложения):

  answer_briefly:
    description: "Краткий ответ на вопрос (универсальный)"
    addresses_question: true
    parameters:
      required: [system, history, user_message, collected_data]
    template: |
      {system}

      СИТУАЦИЯ: Клиент задаёт вопрос. Ответ нужен краткий.

      Диалог:
      {history}

      Клиент: "{user_message}"

      Уже знаем: {collected_data}

      Твоя задача:
      1. Дать краткий ответ по сути
      2. При необходимости задать один уточняющий вопрос

      Ответ на русском (1-2 предложения):
