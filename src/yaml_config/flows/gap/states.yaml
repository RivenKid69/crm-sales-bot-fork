# =============================================================================
# GAP SELLING STATES
# =============================================================================
# FIX: Добавлен параметр next_phase_state для обработки прогресс-интентов
# =============================================================================

states:
  gap_current:
    extends: _base_phase
    mixins:
      - gap_rules
    goal: "Понять текущее состояние"
    parameters:
      next_phase_state: gap_future
    rules:
      current_understood: explore_future_state
      current_state_described: acknowledge_and_continue
      unclear: explore_current
    transitions:
      current_understood: gap_future
      agreement: gap_future

  gap_future:
    extends: _base_phase
    mixins:
      - gap_rules
    goal: "Визуализировать желаемое будущее"
    parameters:
      next_phase_state: gap_analysis
    rules:
      future_visualized: identify_gap
      future_described: acknowledge_and_continue
      unclear: explore_future
    transitions:
      future_visualized: gap_analysis
      agreement: gap_analysis

  gap_analysis:
    extends: _base_phase
    mixins:
      - gap_rules
    goal: "Показать разрыв"
    parameters:
      next_phase_state: gap_solution
    rules:
      gap_identified: present_solution
      gap_acknowledged: acknowledge_and_continue
      unclear: highlight_gap
    transitions:
      gap_identified: gap_solution
      agreement: gap_solution

  gap_solution:
    extends: _base_phase
    mixins:
      - gap_rules
    goal: "Показать как решение заполняет разрыв"
    parameters:
      next_phase_state: presentation
    rules:
      solution_accepted: acknowledge_and_continue
      solution_question: explain_fit
      unclear: clarify_solution
    transitions:
      solution_accepted: presentation
      agreement: presentation
      commitment: close
