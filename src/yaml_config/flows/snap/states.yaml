# =============================================================================
# SNAP SELLING STATES
# =============================================================================
# FIX: Переработано для использования universal intents
# =============================================================================

states:
  snap_simple:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Сделать всё максимально просто"
    phase: simple
    required_data:
      - company_size
    parameters:
      prev_phase_state: greeting
      next_phase_state: snap_value
      default_price_action: answer_with_pricing
      default_unclear_action: continue_current_goal
    rules:
      unclear: keep_it_simple
    transitions:
      data_complete: snap_value

  snap_value:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Показать незаменимую ценность"
    on_enter:
      set_flags:
        value_probed: true
    required_data:
      - value_probed
    parameters:
      prev_phase_state: snap_simple
      next_phase_state: snap_align
      default_price_action: answer_with_pricing
      default_unclear_action: continue_current_goal
    rules:
      unclear: clarify_value
    transitions:
      data_complete: snap_align

  snap_align:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Выровняться с приоритетами клиента"
    phase: align
    required_data:
      - pain_point
    parameters:
      prev_phase_state: snap_value
      next_phase_state: snap_priority
      default_price_action: answer_with_pricing
      default_unclear_action: continue_current_goal
    rules:
      unclear: explore_priorities
    transitions:
      data_complete: snap_priority

  snap_priority:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Поднять приоритет нашего решения"
    on_enter:
      set_flags:
        priority_probed: true
    required_data:
      - priority_probed
    parameters:
      prev_phase_state: snap_align
      next_phase_state: presentation
      default_price_action: answer_with_facts
      default_unclear_action: continue_current_goal
    rules:
      unclear: create_urgency
    transitions:
      data_complete: presentation
      demo_request: close
      callback_request: close
