# =============================================================================
# CUSTOMER CENTRIC STATES
# =============================================================================
# FIX: Переработано для использования universal intents
# =============================================================================

states:
  cc_listen:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Внимательно слушать клиента"
    on_enter:
      set_flags:
        listen_probed: true
    required_data:
      - listen_probed
    parameters:
      prev_phase_state: greeting
      next_phase_state: cc_understand
      default_price_action: answer_with_pricing
      default_unclear_action: continue_current_goal
    rules:
      unclear: encourage_sharing
    transitions:
      data_complete: cc_understand

  cc_understand:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Глубоко понять ситуацию"
    phase: understand
    required_data:
      - company_size
    parameters:
      prev_phase_state: cc_listen
      next_phase_state: cc_empower
      default_price_action: answer_with_pricing
      default_unclear_action: continue_current_goal
    rules:
      unclear: explore_deeper
    transitions:
      data_complete: cc_empower

  cc_empower:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Дать клиенту возможность принять решение"
    required_data:
      - pain_point
    parameters:
      prev_phase_state: cc_understand
      next_phase_state: cc_support
      default_price_action: answer_with_pricing
      default_unclear_action: continue_current_goal
    rules:
      unclear: present_choices
    transitions:
      data_complete: cc_support

  cc_support:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Поддержать в принятии решения"
    required_data:
      - desired_outcome
    parameters:
      prev_phase_state: cc_empower
      next_phase_state: presentation
      default_price_action: answer_with_facts
      default_unclear_action: continue_current_goal
    rules:
      unclear: offer_assistance
    transitions:
      data_complete: presentation
      demo_request: close
      callback_request: close
