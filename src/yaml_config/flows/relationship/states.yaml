# =============================================================================
# RELATIONSHIP SELLING STATES
# =============================================================================
# FIX: Переработано для использования universal intents
# =============================================================================

states:
  rel_connect:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Установить первый контакт"
    on_enter:
      set_flags:
        connect_probed: true
    required_data:
      - connect_probed
    parameters:
      prev_phase_state: greeting
      next_phase_state: rel_rapport
      default_price_action: deflect_and_continue
      default_unclear_action: continue_current_goal
    rules:
      greeting: warm_welcome
      unclear: initiate_connection
    transitions:
      data_complete: rel_rapport

  rel_rapport:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Построить взаимопонимание"
    on_enter:
      set_flags:
        rapport_probed: true
    required_data:
      - rapport_probed
    parameters:
      prev_phase_state: rel_connect
      next_phase_state: rel_nurture
      default_price_action: deflect_and_continue
      default_unclear_action: continue_current_goal
    rules:
      small_talk: build_rapport
      unclear: find_common_ground
    transitions:
      data_complete: rel_nurture

  rel_nurture:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Развивать отношения"
    required_data:
      - company_size
    parameters:
      prev_phase_state: rel_rapport
      next_phase_state: rel_partnership
      default_price_action: deflect_and_continue
      default_unclear_action: continue_current_goal
    rules:
      unclear: provide_value
    transitions:
      data_complete: rel_partnership

  rel_partnership:
    extends: _base_phase
    mixins:
      - unified_progress
    goal: "Сформировать партнёрство"
    required_data:
      - desired_outcome
    parameters:
      prev_phase_state: rel_nurture
      next_phase_state: presentation
      default_price_action: answer_with_facts
      default_unclear_action: continue_current_goal
    rules:
      unclear: propose_partnership
    transitions:
      data_complete: presentation
      demo_request: close
      callback_request: close
