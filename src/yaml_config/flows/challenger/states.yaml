# =============================================================================
# CHALLENGER STATES
# =============================================================================
# FIX: Переработано для использования universal intents
# Маппинг:
#   insight_accepted → agreement, info_provided
#   reframe_accepted → agreement
#   commitment → demo_request, agreement
# =============================================================================

states:
  challenger_teach:
    extends: _base_phase
    mixins:
      - unified_progress
      - challenger_rules
    goal: "Поделиться инсайтом, вызвать переосмысление"
    parameters:
      next_phase_state: challenger_tailor
      default_price_action: deflect_and_continue
      default_unclear_action: continue_current_goal
    rules:
      unclear: clarify_insight
      no_problem: challenge_assumption  # Клиент не видит проблем → бросаем вызов
    transitions:
      data_complete: challenger_tailor

  challenger_tailor:
    extends: _base_phase
    mixins:
      - unified_progress
      - challenger_rules
    goal: "Кастомизировать решение под клиента"
    parameters:
      next_phase_state: challenger_close
      default_price_action: deflect_and_continue
      default_unclear_action: continue_current_goal
    rules:
      unclear: clarify_needs
    transitions:
      data_complete: challenger_close

  challenger_close:
    extends: _base_phase
    mixins:
      - unified_progress
      - challenger_rules
    goal: "Взять контроль и закрыть сделку"
    parameters:
      next_phase_state: close
      default_price_action: answer_with_facts
      default_unclear_action: continue_current_goal
    rules:
      unclear: direct_to_action
    transitions:
      data_complete: close
      demo_request: close
      callback_request: close
