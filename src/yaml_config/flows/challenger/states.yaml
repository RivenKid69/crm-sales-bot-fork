# =============================================================================
# CHALLENGER STATES
# =============================================================================
# FIX: Добавлен параметр next_phase_state для обработки прогресс-интентов
# (situation_provided, problem_revealed, etc.) через mixin phase_progress.
# =============================================================================

states:
  challenger_teach:
    extends: _base_phase
    mixins:
      - challenger_rules
    goal: "Поделиться инсайтом, вызвать переосмысление"
    parameters:
      next_phase_state: challenger_tailor  # FIX: Прогресс-интенты → следующая фаза
    rules:
      insight_accepted: deepen_insight
      client_resistant: reframe_perspective
      status_quo_defended: challenge_assumption
      unclear: clarify_insight
    transitions:
      insight_accepted: challenger_tailor
      reframe_accepted: challenger_tailor
      agreement: challenger_tailor

  challenger_tailor:
    extends: _base_phase
    mixins:
      - challenger_rules
    goal: "Кастомизировать решение под клиента"
    parameters:
      next_phase_state: challenger_close  # FIX: Прогресс-интенты → следующая фаза
    rules:
      solution_interest: tailor_message
      specific_question: customize_response
      unclear: clarify_needs
    transitions:
      solution_fit: challenger_close
      agreement: challenger_close
      commitment: challenger_close

  challenger_close:
    extends: _base_phase
    mixins:
      - challenger_rules
    goal: "Взять контроль и закрыть сделку"
    parameters:
      next_phase_state: close  # FIX: Прогресс-интенты → close
    rules:
      commitment: fast_close
      hesitation: assert_leadership
      unclear: direct_to_action
    transitions:
      commitment: close
      agreement: close
